<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scholarship Timeline Management - Ellacy CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        /* Drag & Drop Styles */
        .sortable-ghost {
            opacity: 0.4;
            background: #f3f4f6;
        }
        
        .sortable-chosen {
            transform: rotate(5deg);
        }
        
        .sortable-drag {
            transform: rotate(5deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .drag-handle:hover {
            background-color: #f3f4f6;
            border-radius: 4px;
        }
        
        /* Step card animations */
        .step-card {
            transition: all 0.2s ease;
        }
        
        .step-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Modal animations */
        #templateBuilderModal {
            backdrop-filter: blur(4px);
        }
        
        /* Custom scrollbar for modal */
        #templateBuilderModal .overflow-y-auto::-webkit-scrollbar {
            width: 6px;
        }
        
        #templateBuilderModal .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        #templateBuilderModal .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        #templateBuilderModal .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="fixed left-0 top-0 h-screen w-64 bg-white shadow-lg">
            <div class="p-6">
                <div class="flex items-center mb-2">
                    <img src="../../ApplyLead_logo.png" alt="ApplyLead" class="h-9">
                </div>
                <div class="flex items-center">
                    <span class="px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">Admin</span>
                </div>
            </div>
            <nav class="mt">
                <a href="CRM-dashboard.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                    Dashboard
                </a>
                <a href="CRM-applications.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="file-text" class="w-5 h-5 mr-3"></i>
                    Applications
                </a>
                <a href="CRM-agent.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="users" class="w-5 h-5 mr-3"></i>
                    Agents
                </a>
                <a href="CRM-scholarships.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="graduation-cap" class="w-5 h-5 mr-3"></i>
                    Scholarships
                </a>
                <a href="CRM-scholarship-Timeline.html" class="flex items-center px-6 py-3 text-white ml-4" style="background-color: #d82128;">
                    <i data-lucide="clock" class="w-5 h-5 mr-3"></i>
                    Timeline Management
                </a>
                <a href="CRM-institutions.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="building" class="w-5 h-5 mr-3"></i>
                    Institutions
                </a>
                <a href="CRM-students.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="user" class="w-5 h-5 mr-3"></i>
                    Students
                </a>
                <a href="CRM-payment.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="credit-card" class="w-5 h-5 mr-3"></i>
                    Payments
                </a>
                <a href="CRM-tasks.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="check-circle" class="w-5 h-5 mr-3"></i>
                    Tasks
                </a>
                <a href="CRM-report.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="bar-chart" class="w-5 h-5 mr-3"></i>
                    Reports
                </a>
                <a href="CRM-messages.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="message-circle" class="w-5 h-5 mr-3"></i>
                    Messages
                </a>
                <a href="CRM-user-admin.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="shield" class="w-5 h-5 mr-3"></i>
                    User Admin
                </a>
                <a href="CRM-Setting.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="settings" class="w-5 h-5 mr-3"></i>
                    Settings
                </a>
            </nav>
            <div class="mt-auto px-6 py-4 border-t border-gray-200">
                <p class="text-sm text-gray-600 text-center">Designed & developed by Innotech Viet Nam</p>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="ml-64 flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="h-16 bg-white shadow-sm flex items-center justify-between px-6">
                <div class="flex items-center">
                    <h2 class="text-xl font-semibold text-gray-800">Timeline Management</h2>
                    <nav class="ml-4 text-sm text-gray-500">
                        <span>CRM Dashboard</span>
                        <i data-lucide="chevron-right" class="w-4 h-4 inline mx-2"></i>
                        <span>Scholarships</span>
                        <i data-lucide="chevron-right" class="w-4 h-4 inline mx-2"></i>
                        <span class="text-gray-800">Timeline Management</span>
                    </nav>
                </div>
                <div class="flex items-center">
                    <button class="p-2 hover:bg-gray-100 rounded-full">
                        <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
                    </button>
                    <div class="relative ml-4" id="profile-menu">
                        <button class="flex items-center">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                alt="Admin profile" class="w-8 h-8 rounded-full object-cover">
                        </button>
                        <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                            <hr class="my-2">
                            <button onclick="handleLogout()" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Overview Cards -->
            <div class="p-6 pb-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-blue-100">
                                <i data-lucide="clock" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Active Timelines</p>
                                <p class="text-2xl font-bold text-gray-900">24</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-red-100">
                                <i data-lucide="alert-triangle" class="w-6 h-6 text-red-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Overdue Steps</p>
                                <p class="text-2xl font-bold text-gray-900">3</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-green-100">
                                <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Completed This Week</p>
                                <p class="text-2xl font-bold text-gray-900">12</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg bg-purple-100">
                                <i data-lucide="trending-up" class="w-6 h-6 text-purple-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Avg. Completion</p>
                                <p class="text-2xl font-bold text-gray-900">28d</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="flex-1 flex overflow-hidden">
                <!-- Left Panel: Process Templates (40%) -->
                <div class="w-2/5 bg-white shadow-sm border-r border-gray-200 flex flex-col">
                    <!-- Templates Header -->
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Process Templates</h3>
                            <button onclick="openTemplateBuilder()" class="inline-flex items-center px-4 py-2 text-white text-sm font-medium rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2" style="background-color: #d82128;">
                                <i data-lucide="plus" class="w-4 h-4 mr-1.5"></i>
                                New Template
                            </button>
                        </div>
                        
                        <!-- Templates Filters -->
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <select class="w-full text-sm rounded-md border-gray-300" id="template-status-filter">
                                    <option>All Status</option>
                                    <option>Active</option>
                                    <option>Draft</option>
                                    <option>Archived</option>
                                </select>
                            </div>
                            <div>
                                <select class="w-full text-sm rounded-md border-gray-300" id="template-owner-filter">
                                    <option>All Owners</option>
                                    <option>Marketing</option>
                                    <option>Admissions</option>
                                    <option>Finance</option>
                                    <option>Visa</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <input type="text" placeholder="Search templates..." class="w-full text-sm rounded-md border-gray-300" id="template-search">
                        </div>
                    </div>

                    <!-- Templates List -->
                    <div class="flex-1 overflow-y-auto" id="templates-list">
                        <!-- Template Card 1 - Active -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer template-card" data-template-id="1">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900">Standard 9-Step Process</h4>
                                        <span class="ml-2 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Active</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-2">Complete scholarship application process with all standard requirements</p>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4">
                                        <span class="flex items-center">
                                            <i data-lucide="layers" class="w-3 h-3 mr-1"></i>
                                            9 steps
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="users" class="w-3 h-3 mr-1"></i>
                                            Admissions
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i>
                                            18 in use
                                        </span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-400">
                                        Updated 2 days ago
                                    </div>
                                </div>
                                <div class="flex items-center space-x-1 ml-4">
                                    <button onclick="viewTemplate(1)" class="p-1 text-gray-400 hover:text-gray-600" title="View">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="editTemplate(1)" class="p-1 text-gray-400 hover:text-gray-600" title="Edit">
                                        <i data-lucide="edit" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="duplicateTemplate(1)" class="p-1 text-gray-400 hover:text-gray-600" title="Duplicate">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTemplateMenu(1)" class="p-1 text-gray-400 hover:text-gray-600" title="More">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="template-menu-1" class="hidden absolute right-0 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="archiveTemplate(1)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Archive</button>
                                            <button onclick="exportTemplate(1)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Export JSON</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Template Card 2 - Draft -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer template-card" data-template-id="2">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900">Express 5-Step Process</h4>
                                        <span class="ml-2 px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Draft</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-2">Streamlined process for urgent scholarship applications</p>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4">
                                        <span class="flex items-center">
                                            <i data-lucide="layers" class="w-3 h-3 mr-1"></i>
                                            5 steps
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="users" class="w-3 h-3 mr-1"></i>
                                            Marketing
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i>
                                            0 in use
                                        </span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-400">
                                        Updated 1 week ago
                                    </div>
                                </div>
                                <div class="flex items-center space-x-1 ml-4">
                                    <button onclick="viewTemplate(2)" class="p-1 text-gray-400 hover:text-gray-600" title="View">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="editTemplate(2)" class="p-1 text-gray-400 hover:text-gray-600" title="Edit">
                                        <i data-lucide="edit" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="duplicateTemplate(2)" class="p-1 text-gray-400 hover:text-gray-600" title="Duplicate">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTemplateMenu(2)" class="p-1 text-gray-400 hover:text-gray-600" title="More">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="template-menu-2" class="hidden absolute right-0 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="activateTemplate(2)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Activate</button>
                                            <button onclick="deleteTemplate(2)" class="block w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-gray-100">Delete</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Template Card 3 - Active -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer template-card" data-template-id="3">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900">Premium 12-Step Process</h4>
                                        <span class="ml-2 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Active</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-2">Comprehensive process for high-value scholarships with extensive support</p>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4">
                                        <span class="flex items-center">
                                            <i data-lucide="layers" class="w-3 h-3 mr-1"></i>
                                            12 steps
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="users" class="w-3 h-3 mr-1"></i>
                                            Finance
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i>
                                            6 in use
                                        </span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-400">
                                        Updated 5 days ago
                                    </div>
                                </div>
                                <div class="flex items-center space-x-1 ml-4">
                                    <button onclick="viewTemplate(3)" class="p-1 text-gray-400 hover:text-gray-600" title="View">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="editTemplate(3)" class="p-1 text-gray-400 hover:text-gray-600" title="Edit">
                                        <i data-lucide="edit" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="duplicateTemplate(3)" class="p-1 text-gray-400 hover:text-gray-600" title="Duplicate">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTemplateMenu(3)" class="p-1 text-gray-400 hover:text-gray-600" title="More">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="template-menu-3" class="hidden absolute right-0 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="archiveTemplate(3)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Archive</button>
                                            <button onclick="exportTemplate(3)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Export JSON</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Template Card 4 - Archived -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer template-card" data-template-id="4">
                            <div class="flex items-start justify-between opacity-60">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900">Legacy 7-Step Process</h4>
                                        <span class="ml-2 px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full">Archived</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mb-2">Previous version of standard process (deprecated)</p>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4">
                                        <span class="flex items-center">
                                            <i data-lucide="layers" class="w-3 h-3 mr-1"></i>
                                            7 steps
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="users" class="w-3 h-3 mr-1"></i>
                                            Admissions
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i>
                                            0 in use
                                        </span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-400">
                                        Archived 2 months ago
                                    </div>
                                </div>
                                <div class="flex items-center space-x-1 ml-4">
                                    <button onclick="viewTemplate(4)" class="p-1 text-gray-400 hover:text-gray-600" title="View">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="duplicateTemplate(4)" class="p-1 text-gray-400 hover:text-gray-600" title="Duplicate">
                                        <i data-lucide="copy" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTemplateMenu(4)" class="p-1 text-gray-400 hover:text-gray-600" title="More">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="template-menu-4" class="hidden absolute right-0 mt-1 w-32 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="restoreTemplate(4)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Restore</button>
                                            <button onclick="deleteTemplate(4)" class="block w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-gray-100">Delete Permanently</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Empty State (hidden by default) -->
                        <div id="templates-empty-state" class="hidden p-8 text-center">
                            <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                                <i data-lucide="file-text" class="w-8 h-8 text-gray-400"></i>
                            </div>
                            <h3 class="text-sm font-medium text-gray-900 mb-2">No templates found</h3>
                            <p class="text-xs text-gray-500 mb-4">Create your first process template to get started.</p>
                            <button onclick="openTemplateBuilder()" class="inline-flex items-center px-3 py-2 text-white text-xs font-medium rounded-lg" style="background-color: #d82128;">
                                <i data-lucide="plus" class="w-3 h-3 mr-1"></i>
                                Create Template
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Active Timeline Monitoring (60%) -->
                <div class="flex-1 bg-white flex flex-col">
                    <!-- Timeline Header -->
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Active Timelines</h3>
                            <div class="flex items-center space-x-2">
                                <button class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                                    <i data-lucide="download" class="w-4 h-4 mr-1.5"></i>
                                    Export
                                </button>
                                <button class="inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                                    <i data-lucide="filter" class="w-4 h-4 mr-1.5"></i>
                                    Filters
                                </button>
                            </div>
                        </div>
                        
                        <!-- Timeline Filters -->
                        <div class="grid grid-cols-4 gap-3">
                            <div>
                                <select class="w-full text-sm rounded-md border-gray-300" id="timeline-template-filter">
                                    <option>All Templates</option>
                                    <option>Standard 9-Step</option>
                                    <option>Express 5-Step</option>
                                    <option>Premium 12-Step</option>
                                </select>
                            </div>
                            <div>
                                <select class="w-full text-sm rounded-md border-gray-300" id="timeline-sla-filter">
                                    <option>All SLA Status</option>
                                    <option>On Track</option>
                                    <option>At Risk</option>
                                    <option>Overdue</option>
                                </select>
                            </div>
                            <div>
                                <select class="w-full text-sm rounded-md border-gray-300" id="timeline-step-filter">
                                    <option>All Steps</option>
                                    <option>Initial Advising</option>
                                    <option>Docs Review</option>
                                    <option>Application Prep</option>
                                    <option>School Application</option>
                                </select>
                            </div>
                            <div>
                                <input type="text" placeholder="Search timelines..." class="w-full text-sm rounded-md border-gray-300" id="timeline-search">
                            </div>
                        </div>
                    </div>

                    <!-- Active Timelines List -->
                    <div class="flex-1 overflow-y-auto" id="timelines-list">
                        <!-- Timeline Row 1 - On Track -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer timeline-row" data-timeline-id="1">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900 hover:text-red-600 cursor-pointer" onclick="openTimelineDetail(1)">
                                            Merit Scholarship 2025 - Sarah Johnson
                                        </h4>
                                        <span class="ml-3 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">On Track</span>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4 mb-2">
                                        <span class="flex items-center">
                                            <i data-lucide="template" class="w-3 h-3 mr-1"></i>
                                            Standard 9-Step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                            Step 4: Application Prep
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="calendar" class="w-3 h-3 mr-1"></i>
                                            2 days in step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="user" class="w-3 h-3 mr-1"></i>
                                            Admissions
                                        </span>
                                    </div>
                                    <!-- Progress Bar -->
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 44%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 font-medium">4/9 steps</span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-400">
                                        Next due: Dec 15, 2024 (5 days remaining)
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button onclick="openTimelineDetail(1)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="View Timeline">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="addTimelineNote(1)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="Add Note">
                                        <i data-lucide="message-square" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTimelineMenu(1)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="More Actions">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="timeline-menu-1" class="hidden absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="completeCurrentStep(1)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Complete Step</button>
                                            <button onclick="escalateTimeline(1)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Escalate Issue</button>
                                            <button onclick="pauseTimeline(1)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Pause Timeline</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Row 2 - At Risk -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer timeline-row" data-timeline-id="2">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900 hover:text-red-600 cursor-pointer" onclick="openTimelineDetail(2)">
                                            Excellence Scholarship - Michael Chen
                                        </h4>
                                        <span class="ml-3 px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">At Risk</span>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4 mb-2">
                                        <span class="flex items-center">
                                            <i data-lucide="template" class="w-3 h-3 mr-1"></i>
                                            Premium 12-Step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                            Step 6: School Acceptance
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="calendar" class="w-3 h-3 mr-1"></i>
                                            28 days in step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="user" class="w-3 h-3 mr-1"></i>
                                            Admissions
                                        </span>
                                    </div>
                                    <!-- Progress Bar -->
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-yellow-500 h-2 rounded-full" style="width: 50%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 font-medium">6/12 steps</span>
                                    </div>
                                    <div class="mt-2 text-xs text-yellow-600 flex items-center">
                                        <i data-lucide="alert-triangle" class="w-3 h-3 mr-1"></i>
                                        SLA Warning: 2 days remaining
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button onclick="openTimelineDetail(2)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="View Timeline">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="addTimelineNote(2)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="Add Note">
                                        <i data-lucide="message-square" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTimelineMenu(2)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="More Actions">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="timeline-menu-2" class="hidden absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="completeCurrentStep(2)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Complete Step</button>
                                            <button onclick="escalateTimeline(2)" class="block w-full text-left px-3 py-2 text-xs text-orange-600 hover:bg-gray-100">Escalate Issue</button>
                                            <button onclick="extendSLA(2)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Extend SLA</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Row 3 - Overdue -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer timeline-row" data-timeline-id="3">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900 hover:text-red-600 cursor-pointer" onclick="openTimelineDetail(3)">
                                            Global Leaders Scholarship - Emma Wilson
                                        </h4>
                                        <span class="ml-3 px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">Overdue</span>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4 mb-2">
                                        <span class="flex items-center">
                                            <i data-lucide="template" class="w-3 h-3 mr-1"></i>
                                            Standard 9-Step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                            Step 2: Docs Review
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="calendar" class="w-3 h-3 mr-1"></i>
                                            8 days in step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="user" class="w-3 h-3 mr-1"></i>
                                            Admissions
                                        </span>
                                    </div>
                                    <!-- Progress Bar -->
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-red-500 h-2 rounded-full" style="width: 22%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 font-medium">2/9 steps</span>
                                    </div>
                                    <div class="mt-2 text-xs text-red-600 flex items-center">
                                        <i data-lucide="alert-circle" class="w-3 h-3 mr-1"></i>
                                        Overdue by 3 days - Requires immediate attention
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button onclick="openTimelineDetail(3)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="View Timeline">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="addTimelineNote(3)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="Add Note">
                                        <i data-lucide="message-square" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTimelineMenu(3)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="More Actions">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="timeline-menu-3" class="hidden absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="completeCurrentStep(3)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Complete Step</button>
                                            <button onclick="escalateTimeline(3)" class="block w-full text-left px-3 py-2 text-xs text-red-600 hover:bg-gray-100">Urgent Escalation</button>
                                            <button onclick="reassignStep(3)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Reassign Step</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Row 4 - On Track -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer timeline-row" data-timeline-id="4">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900 hover:text-red-600 cursor-pointer" onclick="openTimelineDetail(4)">
                                            Future Leaders Fund - David Kim
                                        </h4>
                                        <span class="ml-3 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">On Track</span>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4 mb-2">
                                        <span class="flex items-center">
                                            <i data-lucide="template" class="w-3 h-3 mr-1"></i>
                                            Standard 9-Step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                            Step 7: Visa App
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="calendar" class="w-3 h-3 mr-1"></i>
                                            12 days in step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="user" class="w-3 h-3 mr-1"></i>
                                            Visa
                                        </span>
                                    </div>
                                    <!-- Progress Bar -->
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 78%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 font-medium">7/9 steps</span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-400">
                                        Next due: Dec 28, 2024 (8 days remaining)
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button onclick="openTimelineDetail(4)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="View Timeline">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="addTimelineNote(4)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="Add Note">
                                        <i data-lucide="message-square" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTimelineMenu(4)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="More Actions">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="timeline-menu-4" class="hidden absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="completeCurrentStep(4)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Complete Step</button>
                                            <button onclick="addTimelineNote(4)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Add Progress Note</button>
                                            <button onclick="viewDocuments(4)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">View Documents</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Row 5 - On Track -->
                        <div class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer timeline-row" data-timeline-id="5">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <h4 class="text-sm font-semibold text-gray-900 hover:text-red-600 cursor-pointer" onclick="openTimelineDetail(5)">
                                            Innovation Scholarship - Lisa Zhang
                                        </h4>
                                        <span class="ml-3 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">On Track</span>
                                    </div>
                                    <div class="flex items-center text-xs text-gray-500 space-x-4 mb-2">
                                        <span class="flex items-center">
                                            <i data-lucide="template" class="w-3 h-3 mr-1"></i>
                                            Standard 9-Step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="clock" class="w-3 h-3 mr-1"></i>
                                            Step 1: Initial Advising
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="calendar" class="w-3 h-3 mr-1"></i>
                                            1 day in step
                                        </span>
                                        <span class="flex items-center">
                                            <i data-lucide="user" class="w-3 h-3 mr-1"></i>
                                            Agent
                                        </span>
                                    </div>
                                    <!-- Progress Bar -->
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 11%"></div>
                                        </div>
                                        <span class="text-xs text-gray-500 font-medium">1/9 steps</span>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-400">
                                        Next due: Dec 12, 2024 (2 days remaining)
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button onclick="openTimelineDetail(5)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="View Timeline">
                                        <i data-lucide="eye" class="w-4 h-4"></i>
                                    </button>
                                    <button onclick="addTimelineNote(5)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="Add Note">
                                        <i data-lucide="message-square" class="w-4 h-4"></i>
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleTimelineMenu(5)" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded" title="More Actions">
                                            <i data-lucide="more-vertical" class="w-4 h-4"></i>
                                        </button>
                                        <div id="timeline-menu-5" class="hidden absolute right-0 mt-1 w-40 bg-white rounded-md shadow-lg border border-gray-200 z-10">
                                            <button onclick="completeCurrentStep(5)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Complete Step</button>
                                            <button onclick="scheduleAdvising(5)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Schedule Advising</button>
                                            <button onclick="contactStudent(5)" class="block w-full text-left px-3 py-2 text-xs text-gray-700 hover:bg-gray-100">Contact Student</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Empty State (hidden by default) -->
                        <div id="timelines-empty-state" class="hidden p-8 text-center">
                            <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                                <i data-lucide="clock" class="w-8 h-8 text-gray-400"></i>
                            </div>
                            <h3 class="text-sm font-medium text-gray-900 mb-2">No active timelines found</h3>
                            <p class="text-xs text-gray-500 mb-4">Timelines will appear here when scholarships are assigned to students.</p>
                            <button onclick="window.location.href='CRM-scholarships.html'" class="inline-flex items-center px-3 py-2 text-white text-xs font-medium rounded-lg" style="background-color: #d82128;">
                                <i data-lucide="graduation-cap" class="w-3 h-3 mr-1"></i>
                                Manage Scholarships
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Floating Button -->
    <div id="ai-assistant" class="fixed bottom-6 right-6 z-50">
        <button id="ai-toggle" class="w-14 h-14 rounded-full text-white shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center" style="background-color: #d82128;">
            <i data-lucide="message-circle" class="w-6 h-6"></i>
        </button>
        
        <!-- AI Chat Panel -->
        <div id="ai-chat-panel" class="hidden absolute bottom-16 right-0 w-80 h-96 bg-white rounded-lg shadow-xl border border-gray-200">
            <!-- Chat Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-200" style="background-color: #d82128;">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center mr-3">
                        <i data-lucide="bot" class="w-4 h-4" style="color: #d82128;"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-white">Timeline AI Assistant</h3>
                        <p class="text-xs text-red-100">Online</p>
                    </div>
                </div>
                <button id="ai-close" class="text-white hover:text-red-100">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            
            <!-- Chat Messages -->
            <div id="chat-messages" class="flex-1 p-4 h-64 overflow-y-auto">
                <div class="mb-4">
                    <div class="flex items-start">
                        <div class="w-6 h-6 rounded-full bg-red-100 flex items-center justify-center mr-2 mt-1">
                            <i data-lucide="bot" class="w-3 h-3" style="color: #d82128;"></i>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-sm text-gray-800">Hello! I can help you optimize timeline processes, identify bottlenecks, and suggest improvements. What would you like to know?</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center">
                    <input type="text" id="chat-input" placeholder="Ask about timelines..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500">
                    <button id="send-message" class="ml-2 p-2 rounded-lg text-white" style="background-color: #d82128;">
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Builder Modal -->
    <div id="templateBuilderModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-4 mx-auto p-6 border w-11/12 max-w-7xl shadow-lg rounded-md bg-white max-h-[95vh] overflow-y-auto">
            <div class="flex justify-between items-center pb-4 border-b border-gray-200">
                <h3 class="text-xl font-semibold" id="templateBuilderTitle">Create Process Template</h3>
                <button onclick="closeTemplateBuilder()" class="text-gray-400 hover:text-gray-500">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Template Information Section -->
            <div class="mt-6 mb-8">
                <h4 class="text-lg font-medium text-gray-900 mb-4">Template Information</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Template Name <span class="text-red-500">*</span></label>
                        <input id="template-name" type="text" class="w-full rounded-md border-gray-300" placeholder="e.g., Standard 9-Step Process" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Owner/Team <span class="text-red-500">*</span></label>
                        <select id="template-owner" class="w-full rounded-md border-gray-300" required>
                            <option value="">Select Owner</option>
                            <option>Marketing</option>
                            <option>Admissions</option>
                            <option>Finance</option>
                            <option>Visa</option>
                            <option>Student Services</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="template-status" class="w-full rounded-md border-gray-300">
                            <option>Draft</option>
                            <option>Active</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Default SLA (Total Days)</label>
                        <input id="template-sla" type="number" class="w-full rounded-md border-gray-300" placeholder="45" min="1">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="template-description" class="w-full rounded-md border-gray-300" rows="2" placeholder="Brief description of this process template..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Steps Builder Section -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-medium text-gray-900">Process Steps</h4>
                    <button onclick="addNewStep()" class="inline-flex items-center px-3 py-2 text-white text-sm font-medium rounded-lg hover:opacity-90" style="background-color: #d82128;">
                        <i data-lucide="plus" class="w-4 h-4 mr-1.5"></i>
                        Add Step
                    </button>
                </div>

                <!-- Steps Container (Sortable) -->
                <div id="steps-container" class="space-y-4">
                    <!-- Sample Step 1 -->
                    <div class="step-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm" data-step-id="1">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center">
                                <div class="drag-handle cursor-move mr-3 p-1 text-gray-400 hover:text-gray-600">
                                    <i data-lucide="grip-vertical" class="w-4 h-4"></i>
                                </div>
                                <div class="step-number bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full mr-3">1</div>
                                <h5 class="text-sm font-semibold text-gray-900">Initial Advising</h5>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="toggleStepExpand(1)" class="p-1 text-gray-400 hover:text-gray-600" title="Expand/Collapse">
                                    <i data-lucide="chevron-down" class="w-4 h-4 step-chevron"></i>
                                </button>
                                <button onclick="duplicateStep(1)" class="p-1 text-gray-400 hover:text-gray-600" title="Duplicate">
                                    <i data-lucide="copy" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteStep(1)" class="p-1 text-gray-400 hover:text-red-600" title="Delete">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step Details (Expandable) -->
                        <div class="step-details" id="step-details-1">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Step Name <span class="text-red-500">*</span></label>
                                    <input type="text" class="w-full text-sm rounded-md border-gray-300" value="Initial Advising" required>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">SLA Days <span class="text-red-500">*</span></label>
                                    <input type="number" class="w-full text-sm rounded-md border-gray-300" value="3" min="1" required>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Responsible Role <span class="text-red-500">*</span></label>
                                    <select class="w-full text-sm rounded-md border-gray-300" required>
                                        <option>Agent</option>
                                        <option>Admissions</option>
                                        <option>Finance</option>
                                        <option>Visa</option>
                                        <option>Student</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="block text-xs font-medium text-gray-700 mb-1">Description</label>
                                <textarea class="w-full text-sm rounded-md border-gray-300" rows="2" placeholder="Detailed description of this step...">Initial consultation and advising session with student</textarea>
                            </div>

                            <!-- Required Documents -->
                            <div class="mb-4">
                                <label class="block text-xs font-medium text-gray-700 mb-2">Required Documents</label>
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full flex items-center">
                                        Passport Scan
                                        <button class="ml-1 text-blue-600 hover:text-blue-800">
                                            <i data-lucide="x" class="w-3 h-3"></i>
                                        </button>
                                    </span>
                                    <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full flex items-center">
                                        Academic Transcript
                                        <button class="ml-1 text-blue-600 hover:text-blue-800">
                                            <i data-lucide="x" class="w-3 h-3"></i>
                                        </button>
                                    </span>
                                    <button class="px-2 py-1 text-xs border border-gray-300 text-gray-600 rounded-full hover:bg-gray-50">
                                        <i data-lucide="plus" class="w-3 h-3 mr-1"></i>
                                        Add Document
                                    </button>
                                </div>
                            </div>

                            <!-- Exit Criteria -->
                            <div class="mb-4">
                                <label class="block text-xs font-medium text-gray-700 mb-2">Exit Criteria (All must be met)</label>
                                <div class="space-y-2">
                                    <div class="flex items-center">
                                        <input type="checkbox" class="rounded border-gray-300 text-red-600" checked>
                                        <span class="ml-2 text-xs text-gray-700">Advising session completed</span>
                                        <button class="ml-auto text-gray-400 hover:text-red-600">
                                            <i data-lucide="x" class="w-3 h-3"></i>
                                        </button>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" class="rounded border-gray-300 text-red-600">
                                        <span class="ml-2 text-xs text-gray-700">Student profile updated</span>
                                        <button class="ml-auto text-gray-400 hover:text-red-600">
                                            <i data-lucide="x" class="w-3 h-3"></i>
                                        </button>
                                    </div>
                                    <button class="text-xs text-gray-600 hover:text-gray-800 flex items-center">
                                        <i data-lucide="plus" class="w-3 h-3 mr-1"></i>
                                        Add Criteria
                                    </button>
                                </div>
                            </div>

                            <!-- Auto-Triggers -->
                            <div class="mb-4">
                                <label class="block text-xs font-medium text-gray-700 mb-2">Auto-Triggers</label>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <div class="flex items-center mb-2">
                                            <input type="checkbox" class="rounded border-gray-300 text-red-600">
                                            <span class="ml-2 text-xs text-gray-700">Create Task</span>
                                        </div>
                                        <select class="w-full text-xs rounded-md border-gray-300" disabled>
                                            <option>Select Role</option>
                                            <option>Agent</option>
                                            <option>Admissions</option>
                                            <option>Finance</option>
                                        </select>
                                    </div>
                                    <div>
                                        <div class="flex items-center mb-2">
                                            <input type="checkbox" class="rounded border-gray-300 text-red-600" checked>
                                            <span class="ml-2 text-xs text-gray-700">Send Notification</span>
                                        </div>
                                        <select class="w-full text-xs rounded-md border-gray-300">
                                            <option>Welcome Email Template</option>
                                            <option>Document Request Template</option>
                                            <option>Custom Template</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Visibility & Dependencies -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Visibility Level</label>
                                    <select class="w-full text-xs rounded-md border-gray-300">
                                        <option>Internal Only</option>
                                        <option>Agent Visible</option>
                                        <option>Student Visible</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Dependencies</label>
                                    <select class="w-full text-xs rounded-md border-gray-300" disabled>
                                        <option>No dependencies (First step)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sample Step 2 -->
                    <div class="step-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm" data-step-id="2">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center">
                                <div class="drag-handle cursor-move mr-3 p-1 text-gray-400 hover:text-gray-600">
                                    <i data-lucide="grip-vertical" class="w-4 h-4"></i>
                                </div>
                                <div class="step-number bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full mr-3">2</div>
                                <h5 class="text-sm font-semibold text-gray-900">Document Review</h5>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="toggleStepExpand(2)" class="p-1 text-gray-400 hover:text-gray-600" title="Expand/Collapse">
                                    <i data-lucide="chevron-right" class="w-4 h-4 step-chevron"></i>
                                </button>
                                <button onclick="duplicateStep(2)" class="p-1 text-gray-400 hover:text-gray-600" title="Duplicate">
                                    <i data-lucide="copy" class="w-4 h-4"></i>
                                </button>
                                <button onclick="deleteStep(2)" class="p-1 text-gray-400 hover:text-red-600" title="Delete">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step Details (Collapsed) -->
                        <div class="step-details hidden" id="step-details-2">
                            <div class="text-xs text-gray-500 mb-2">
                                SLA: 5 days  Responsible: Admissions  Dependencies: Step 1
                            </div>
                            <!-- Full details would be similar to Step 1 -->
                        </div>
                    </div>

                    <!-- Add Step Placeholder -->
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors">
                        <button onclick="addNewStep()" class="text-gray-500 hover:text-gray-700">
                            <i data-lucide="plus" class="w-8 h-8 mx-auto mb-2"></i>
                            <p class="text-sm">Add New Step</p>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Template Preview -->
            <div class="mb-8 bg-gray-50 rounded-lg p-4">
                <h4 class="text-sm font-medium text-gray-900 mb-3">Template Preview</h4>
                <div class="flex items-center space-x-2 overflow-x-auto pb-2">
                    <div class="flex items-center bg-white rounded-lg px-3 py-2 shadow-sm border min-w-max">
                        <div class="w-6 h-6 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center mr-2">1</div>
                        <span class="text-xs font-medium">Initial Advising</span>
                        <span class="text-xs text-gray-500 ml-2">(3d)</span>
                    </div>
                    <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400"></i>
                    <div class="flex items-center bg-white rounded-lg px-3 py-2 shadow-sm border min-w-max">
                        <div class="w-6 h-6 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center mr-2">2</div>
                        <span class="text-xs font-medium">Document Review</span>
                        <span class="text-xs text-gray-500 ml-2">(5d)</span>
                    </div>
                    <i data-lucide="plus" class="w-4 h-4 text-gray-400"></i>
                    <div class="text-xs text-gray-500">Add more steps...</div>
                </div>
                <div class="mt-3 text-xs text-gray-600">
                    Total estimated duration: <span class="font-medium">8 days</span>  
                    Steps: <span class="font-medium">2</span>  
                    Roles involved: <span class="font-medium">Agent, Admissions</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end pt-4 border-t border-gray-200 space-x-3">
                <button onclick="closeTemplateBuilder()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">Cancel</button>
                <button onclick="saveTemplate()" class="px-4 py-2 text-white rounded-lg hover:opacity-90 flex items-center" style="background-color: #d82128;">
                    <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                    Save Template
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Profile dropdown functionality
        const profileMenu = document.getElementById('profile-menu');
        const profileDropdown = document.getElementById('profile-dropdown');

        if (profileMenu && profileDropdown) {
            profileMenu.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', () => {
                profileDropdown.classList.add('hidden');
            });

            profileDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }

        // AI Assistant functionality
        const aiToggle = document.getElementById('ai-toggle');
        const aiChatPanel = document.getElementById('ai-chat-panel');
        const aiClose = document.getElementById('ai-close');
        const chatInput = document.getElementById('chat-input');
        const sendMessage = document.getElementById('send-message');
        const chatMessages = document.getElementById('chat-messages');

        aiToggle.addEventListener('click', () => {
            aiChatPanel.classList.toggle('hidden');
        });

        aiClose.addEventListener('click', () => {
            aiChatPanel.classList.add('hidden');
        });

        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'mb-4';
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="flex items-start justify-end">
                        <div class="rounded-lg p-3 max-w-xs text-white" style="background-color: #d82128;">
                            <p class="text-sm">${message}</p>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-start">
                        <div class="w-6 h-6 rounded-full bg-red-100 flex items-center justify-center mr-2 mt-1">
                            <i data-lucide="bot" class="w-3 h-3" style="color: #d82128;"></i>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-sm text-gray-800">${message}</p>
                        </div>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            lucide.createIcons();
        }

        function handleSendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                addMessage(message, true);
                chatInput.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    const responses = [
                        "I see 3 timelines are overdue in the 'Docs Review' step. Would you like me to send reminder notifications?",
                        "The Standard 9-Step template has a 85% on-time completion rate. Consider optimizing the 'Visa App' step which averages 25 days.",
                        "Timeline bottleneck detected: 'School Application' step is taking 40% longer than SLA. Recommend increasing admissions team capacity.",
                        "Process optimization suggestion: Templates with auto-triggers have 23% faster completion rates. Would you like to enable more automation?"
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse);
                }, 1000);
            }
        }

        sendMessage.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSendMessage();
            }
        });

        // Handle logout
        function handleLogout() {
            console.log('Logging out...');
            window.location.href = '../../login.html';
        }

        // Template Builder Functions
        function openTemplateBuilder(templateId = null) {
            const modal = document.getElementById('templateBuilderModal');
            const title = document.getElementById('templateBuilderTitle');
            
            if (templateId) {
                title.textContent = 'Edit Process Template';
                // Load template data for editing
                loadTemplateData(templateId);
            } else {
                title.textContent = 'Create Process Template';
                // Clear form for new template
                clearTemplateForm();
            }
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Initialize drag & drop for steps
            initializeSortable();
            
            // Re-initialize icons after modal opens
            setTimeout(() => {
                lucide.createIcons();
            }, 100);
        }

        function closeTemplateBuilder() {
            const modal = document.getElementById('templateBuilderModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function clearTemplateForm() {
            document.getElementById('template-name').value = '';
            document.getElementById('template-owner').value = '';
            document.getElementById('template-status').value = 'Draft';
            document.getElementById('template-sla').value = '';
            document.getElementById('template-description').value = '';
        }

        function loadTemplateData(templateId) {
            // Simulate loading template data
            console.log('Loading template data for ID:', templateId);
            // In real implementation, this would fetch data from API
        }

        function saveTemplate() {
            const templateName = document.getElementById('template-name').value;
            const templateOwner = document.getElementById('template-owner').value;
            
            if (!templateName || !templateOwner) {
                showNotification('Please fill in required fields', 'error');
                return;
            }
            
            console.log('Saving template:', templateName);
            showNotification('Template saved successfully!', 'success');
            closeTemplateBuilder();
            
            // Refresh templates list
            // In real implementation, this would save to API and refresh the list
        }

        // Step Management Functions
        let stepCounter = 2; // Start from 3 since we have 2 sample steps

        function addNewStep() {
            stepCounter++;
            const stepsContainer = document.getElementById('steps-container');
            const addStepPlaceholder = stepsContainer.lastElementChild;
            
            const newStepHtml = `
                <div class="step-card bg-white border border-gray-200 rounded-lg p-4 shadow-sm" data-step-id="${stepCounter}">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center">
                            <div class="drag-handle cursor-move mr-3 p-1 text-gray-400 hover:text-gray-600">
                                <i data-lucide="grip-vertical" class="w-4 h-4"></i>
                            </div>
                            <div class="step-number bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full mr-3">${stepCounter}</div>
                            <h5 class="text-sm font-semibold text-gray-900">New Step</h5>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="toggleStepExpand(${stepCounter})" class="p-1 text-gray-400 hover:text-gray-600" title="Expand/Collapse">
                                <i data-lucide="chevron-down" class="w-4 h-4 step-chevron"></i>
                            </button>
                            <button onclick="duplicateStep(${stepCounter})" class="p-1 text-gray-400 hover:text-gray-600" title="Duplicate">
                                <i data-lucide="copy" class="w-4 h-4"></i>
                            </button>
                            <button onclick="deleteStep(${stepCounter})" class="p-1 text-gray-400 hover:text-red-600" title="Delete">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="step-details" id="step-details-${stepCounter}">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Step Name <span class="text-red-500">*</span></label>
                                <input type="text" class="w-full text-sm rounded-md border-gray-300" value="New Step" required>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">SLA Days <span class="text-red-500">*</span></label>
                                <input type="number" class="w-full text-sm rounded-md border-gray-300" value="5" min="1" required>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Responsible Role <span class="text-red-500">*</span></label>
                                <select class="w-full text-sm rounded-md border-gray-300" required>
                                    <option value="">Select Role</option>
                                    <option>Agent</option>
                                    <option>Admissions</option>
                                    <option>Finance</option>
                                    <option>Visa</option>
                                    <option>Student</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-xs font-medium text-gray-700 mb-1">Description</label>
                            <textarea class="w-full text-sm rounded-md border-gray-300" rows="2" placeholder="Detailed description of this step..."></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-xs font-medium text-gray-700 mb-2">Required Documents</label>
                            <div class="flex flex-wrap gap-2">
                                <button class="px-2 py-1 text-xs border border-gray-300 text-gray-600 rounded-full hover:bg-gray-50">
                                    <i data-lucide="plus" class="w-3 h-3 mr-1"></i>
                                    Add Document
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-xs font-medium text-gray-700 mb-2">Exit Criteria</label>
                            <button class="text-xs text-gray-600 hover:text-gray-800 flex items-center">
                                <i data-lucide="plus" class="w-3 h-3 mr-1"></i>
                                Add Criteria
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Visibility Level</label>
                                <select class="w-full text-xs rounded-md border-gray-300">
                                    <option>Internal Only</option>
                                    <option>Agent Visible</option>
                                    <option>Student Visible</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Dependencies</label>
                                <select class="w-full text-xs rounded-md border-gray-300">
                                    <option>Previous step</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            stepsContainer.insertBefore(createElementFromHTML(newStepHtml), addStepPlaceholder);
            updateStepNumbers();
            lucide.createIcons();
        }

        function toggleStepExpand(stepId) {
            const stepDetails = document.getElementById(`step-details-${stepId}`);
            const chevron = document.querySelector(`[onclick="toggleStepExpand(${stepId})"] i`);
            
            if (stepDetails.classList.contains('hidden')) {
                stepDetails.classList.remove('hidden');
                chevron.setAttribute('data-lucide', 'chevron-down');
            } else {
                stepDetails.classList.add('hidden');
                chevron.setAttribute('data-lucide', 'chevron-right');
            }
            
            lucide.createIcons();
        }

        function duplicateStep(stepId) {
            const stepCard = document.querySelector(`[data-step-id="${stepId}"]`);
            const newStepCard = stepCard.cloneNode(true);
            
            stepCounter++;
            newStepCard.setAttribute('data-step-id', stepCounter);
            
            // Update IDs and onclick handlers
            newStepCard.querySelector('.step-details').id = `step-details-${stepCounter}`;
            newStepCard.querySelector('[onclick^="toggleStepExpand"]').setAttribute('onclick', `toggleStepExpand(${stepCounter})`);
            newStepCard.querySelector('[onclick^="duplicateStep"]').setAttribute('onclick', `duplicateStep(${stepCounter})`);
            newStepCard.querySelector('[onclick^="deleteStep"]').setAttribute('onclick', `deleteStep(${stepCounter})`);
            
            stepCard.parentNode.insertBefore(newStepCard, stepCard.nextSibling);
            updateStepNumbers();
            lucide.createIcons();
            
            showNotification('Step duplicated successfully!', 'success');
        }

        function deleteStep(stepId) {
            const stepCard = document.querySelector(`[data-step-id="${stepId}"]`);
            const stepsContainer = document.getElementById('steps-container');
            const stepCards = stepsContainer.querySelectorAll('.step-card');
            
            if (stepCards.length <= 1) {
                showNotification('Cannot delete the last step', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this step?')) {
                stepCard.remove();
                updateStepNumbers();
                showNotification('Step deleted successfully!', 'success');
            }
        }

        function updateStepNumbers() {
            const stepCards = document.querySelectorAll('.step-card');
            stepCards.forEach((card, index) => {
                const stepNumber = card.querySelector('.step-number');
                stepNumber.textContent = index + 1;
            });
        }

        function initializeSortable() {
            const stepsContainer = document.getElementById('steps-container');
            if (stepsContainer && typeof Sortable !== 'undefined') {
                new Sortable(stepsContainer, {
                    handle: '.drag-handle',
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    chosenClass: 'sortable-chosen',
                    dragClass: 'sortable-drag',
                    onEnd: function(evt) {
                        updateStepNumbers();
                        showNotification('Steps reordered successfully!', 'success');
                    }
                });
            }
        }

        function createElementFromHTML(htmlString) {
            const div = document.createElement('div');
            div.innerHTML = htmlString.trim();
            return div.firstChild;
        }

        function viewTemplate(id) {
            console.log('Viewing template:', id);
            // Will show template details in modal
        }

        function editTemplate(id) {
            console.log('Editing template:', id);
            openTemplateBuilder(id);
        }

        function duplicateTemplate(id) {
            console.log('Duplicating template:', id);
            showNotification('Template duplicated successfully!', 'success');
        }

        function archiveTemplate(id) {
            if (confirm('Are you sure you want to archive this template?')) {
                console.log('Archiving template:', id);
                showNotification('Template archived successfully!', 'success');
                // Update UI to show archived state
            }
        }

        function activateTemplate(id) {
            console.log('Activating template:', id);
            showNotification('Template activated successfully!', 'success');
        }

        function restoreTemplate(id) {
            console.log('Restoring template:', id);
            showNotification('Template restored successfully!', 'success');
        }

        function deleteTemplate(id) {
            if (confirm('Are you sure you want to delete this template? This action cannot be undone.')) {
                console.log('Deleting template:', id);
                showNotification('Template deleted successfully!', 'success');
            }
        }

        function exportTemplate(id) {
            console.log('Exporting template:', id);
            showNotification('Template exported successfully!', 'success');
        }

        function toggleTemplateMenu(id) {
            // Close all other menus first
            document.querySelectorAll('[id^="template-menu-"]').forEach(menu => {
                if (menu.id !== `template-menu-${id}`) {
                    menu.classList.add('hidden');
                }
            });
            
            // Toggle the clicked menu
            const menu = document.getElementById(`template-menu-${id}`);
            menu.classList.toggle('hidden');
        }

        // Close template menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('[onclick^="toggleTemplateMenu"]')) {
                document.querySelectorAll('[id^="template-menu-"]').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }
        });

        // Template filtering and search
        function filterTemplates() {
            const statusFilter = document.getElementById('template-status-filter').value;
            const ownerFilter = document.getElementById('template-owner-filter').value;
            const searchTerm = document.getElementById('template-search').value.toLowerCase();
            
            const templateCards = document.querySelectorAll('.template-card');
            let visibleCount = 0;
            
            templateCards.forEach(card => {
                const status = card.querySelector('.rounded-full').textContent;
                const owner = card.querySelector('[data-lucide="users"]').parentElement.textContent.trim();
                const name = card.querySelector('h4').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                
                let showCard = true;
                
                // Status filter
                if (statusFilter !== 'All Status' && status !== statusFilter) {
                    showCard = false;
                }
                
                // Owner filter
                if (ownerFilter !== 'All Owners' && !owner.includes(ownerFilter)) {
                    showCard = false;
                }
                
                // Search filter
                if (searchTerm && !name.includes(searchTerm) && !description.includes(searchTerm)) {
                    showCard = false;
                }
                
                if (showCard) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            // Show/hide empty state
            const emptyState = document.getElementById('templates-empty-state');
            if (visibleCount === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
            }
        }

        // Add event listeners for filters
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('template-status-filter').addEventListener('change', filterTemplates);
            document.getElementById('template-owner-filter').addEventListener('change', filterTemplates);
            document.getElementById('template-search').addEventListener('input', filterTemplates);
            
            // Timeline filters
            document.getElementById('timeline-template-filter').addEventListener('change', filterTimelines);
            document.getElementById('timeline-sla-filter').addEventListener('change', filterTimelines);
            document.getElementById('timeline-step-filter').addEventListener('change', filterTimelines);
            document.getElementById('timeline-search').addEventListener('input', filterTimelines);
        });

        // Timeline Management Functions
        function openTimelineDetail(id) {
            console.log('Opening timeline detail:', id);
            // Will be implemented in Part 4
        }

        function addTimelineNote(id) {
            const note = prompt('Add a note for this timeline:');
            if (note && note.trim()) {
                console.log('Adding note to timeline:', id, note);
                showNotification('Note added successfully!', 'success');
            }
        }

        function completeCurrentStep(id) {
            if (confirm('Mark current step as completed?')) {
                console.log('Completing current step for timeline:', id);
                showNotification('Step completed successfully!', 'success');
                // Update progress bar and move to next step
            }
        }

        function escalateTimeline(id) {
            const reason = prompt('Reason for escalation:');
            if (reason && reason.trim()) {
                console.log('Escalating timeline:', id, reason);
                showNotification('Timeline escalated successfully!', 'success');
            }
        }

        function pauseTimeline(id) {
            const reason = prompt('Reason for pausing timeline:');
            if (reason && reason.trim()) {
                console.log('Pausing timeline:', id, reason);
                showNotification('Timeline paused successfully!', 'success');
            }
        }

        function extendSLA(id) {
            const days = prompt('Extend SLA by how many days?');
            if (days && !isNaN(days) && parseInt(days) > 0) {
                console.log('Extending SLA for timeline:', id, days, 'days');
                showNotification(`SLA extended by ${days} days!`, 'success');
            }
        }

        function reassignStep(id) {
            const newAssignee = prompt('Reassign current step to:');
            if (newAssignee && newAssignee.trim()) {
                console.log('Reassigning step for timeline:', id, 'to', newAssignee);
                showNotification('Step reassigned successfully!', 'success');
            }
        }

        function scheduleAdvising(id) {
            console.log('Scheduling advising for timeline:', id);
            showNotification('Advising session scheduled!', 'success');
        }

        function contactStudent(id) {
            console.log('Contacting student for timeline:', id);
            showNotification('Student contact initiated!', 'success');
        }

        function viewDocuments(id) {
            console.log('Viewing documents for timeline:', id);
            // Will open documents modal
        }

        function toggleTimelineMenu(id) {
            // Close all other menus first
            document.querySelectorAll('[id^="timeline-menu-"]').forEach(menu => {
                if (menu.id !== `timeline-menu-${id}`) {
                    menu.classList.add('hidden');
                }
            });
            
            // Toggle the clicked menu
            const menu = document.getElementById(`timeline-menu-${id}`);
            menu.classList.toggle('hidden');
        }

        // Close timeline menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('[onclick^="toggleTimelineMenu"]')) {
                document.querySelectorAll('[id^="timeline-menu-"]').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }
        });

        // Timeline filtering and search
        function filterTimelines() {
            const templateFilter = document.getElementById('timeline-template-filter').value;
            const slaFilter = document.getElementById('timeline-sla-filter').value;
            const stepFilter = document.getElementById('timeline-step-filter').value;
            const searchTerm = document.getElementById('timeline-search').value.toLowerCase();
            
            const timelineRows = document.querySelectorAll('.timeline-row');
            let visibleCount = 0;
            
            timelineRows.forEach(row => {
                const template = row.querySelector('[data-lucide="template"]').parentElement.textContent.trim();
                const slaStatus = row.querySelector('.rounded-full').textContent;
                const currentStep = row.querySelector('[data-lucide="clock"]').parentElement.textContent.trim();
                const scholarshipName = row.querySelector('h4').textContent.toLowerCase();
                
                let showRow = true;
                
                // Template filter
                if (templateFilter !== 'All Templates' && !template.includes(templateFilter)) {
                    showRow = false;
                }
                
                // SLA filter
                if (slaFilter !== 'All SLA Status' && slaStatus !== slaFilter) {
                    showRow = false;
                }
                
                // Step filter
                if (stepFilter !== 'All Steps' && !currentStep.includes(stepFilter)) {
                    showRow = false;
                }
                
                // Search filter
                if (searchTerm && !scholarshipName.includes(searchTerm)) {
                    showRow = false;
                }
                
                if (showRow) {
                    row.style.display = 'block';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Show/hide empty state
            const emptyState = document.getElementById('timelines-empty-state');
            if (visibleCount === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
            }
        }

        // Notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
            
            if (type === 'success') {
                notification.classList.add('bg-green-500', 'text-white');
            } else if (type === 'error') {
                notification.classList.add('bg-red-500', 'text-white');
            } else {
                notification.classList.add('bg-blue-500', 'text-white');
            }
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            lucide.createIcons();
            
            // Slide in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
