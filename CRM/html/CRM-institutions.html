<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institutions - Ellacy CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Partner carousel animation to match Students page */
        @keyframes partner-marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        .partner-marquee {
            animation: partner-marquee 60s linear infinite;
            will-change: transform;
        }

        .partner-marquee:hover {
            animation-play-state: paused;
        }
    </style>
</head>

<body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="fixed left-0 top-0 h-screen w-64 bg-white shadow-lg">
            <div class="p-6">
                <div class="flex items-center mb-2">
                    <img src="../../ApplyLead_logo.png" alt="ApplyLead" class="h-9">
                </div>
                <div class="flex items-center">
                    <span class="px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">Admin</span>
                </div>
            </div>
            <nav class="mt">
                <a href="CRM-dashboard.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                    Dashboard
                </a>
                <a href="CRM-applications.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="file-text" class="w-5 h-5 mr-3"></i>
                    Applications
                </a>
                <a href="CRM-agent.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="users" class="w-5 h-5 mr-3"></i>
                    Agents
                </a>
                <a href="CRM-scholarships.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="graduation-cap" class="w-5 h-5 mr-3"></i>
                    Scholarships
                </a>
                <a href="CRM-institutions.html" class="flex items-center px-6 py-3 text-white"
                    style="background-color: #d82128;">
                    <i data-lucide="building" class="w-5 h-5 mr-3"></i>
                    Institutions
                </a>
                <a href="CRM-students.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="user" class="w-5 h-5 mr-3"></i>
                    Students
                </a>
                <a href="CRM-payment.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="credit-card" class="w-5 h-5 mr-3"></i>
                    Payments
                </a>
                <a href="CRM-tasks.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="check-circle" class="w-5 h-5 mr-3"></i>
                    Tasks
                </a>
                <a href="CRM-Campaigns.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="brick-wall-shield" class="w-5 h-5 mr-3"></i>
                    Campaigns
                </a>
                <a href="CRM-report.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="bar-chart" class="w-5 h-5 mr-3"></i>
                    Reports
                </a>
                <a href="CRM-messages.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="message-circle" class="w-5 h-5 mr-3"></i>
                    Messages
                </a>
                <a href="CRM-user-admin.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="shield" class="w-5 h-5 mr-3"></i>
                    User Admin
                </a>

                <a href="CRM-Setting.html" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                    <i data-lucide="settings" class="w-5 h-5 mr-3"></i>
                    Settings
                </a>
            </nav>
            <div class="mt-auto px-6 py-4 border-t border-gray-200">
                <p class="text-sm text-gray-600 text-center">Designed & developed by Innotech Viet Nam</p>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="ml-64 flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="h-16 bg-white shadow-sm flex items-center justify-between px-6">
                <h2 class="text-xl font-semibold text-gray-800">Institutions</h2>
                <div class="flex items-center">
                    <button class="p-2 hover:bg-gray-100 rounded-full">
                        <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
                    </button>
                    <div class="relative ml-4" id="profile-menu">
                        <button class="flex items-center">
                            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                                alt="Admin profile" class="w-8 h-8 rounded-full">
                        </button>
                        <div id="profile-dropdown"
                            class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Profile</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Settings</a>
                            <hr class="my-2">
                            <button onclick="handleLogout()"
                                class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Logout</button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Filter & Search Bar -->
            <div class="p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <i data-lucide="search"
                                class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" placeholder="Search institutions..."
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-red-400 focus:border-red-400 w-64">
                        </div>
                        <button id="filter-toggle"
                            class="inline-flex items-center px-4 py-2 border border-red-400 text-red-400 rounded-lg hover:bg-gray-50">
                            <i data-lucide="filter" class="w-4 h-4 mr-2"></i>
                            Filters
                        </button>
                    </div>
                    <button onclick="openAddInstitutionModal()"
                        class="inline-flex items-center px-4 py-2 bg-red-400 text-white text-sm font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <i data-lucide="plus" class="w-4 h-4 mr-1"></i>
                        Add Institution
                    </button>
                </div>
            </div>

            <!-- Filter Drawer Backdrop -->
            <div id="filter-backdrop"
                class="fixed inset-0 bg-black bg-opacity-50 z-40 opacity-0 pointer-events-none transition-opacity duration-300">
            </div>

            <!-- Filter Drawer -->
            <div id="filter-drawer"
                class="fixed top-0 right-0 h-full w-96 bg-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 overflow-hidden flex flex-col">
                <!-- Drawer Header -->
                <div class="flex-shrink-0 border-b border-gray-200">
                    <div class="p-4 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <button id="close-filter" class="text-gray-400 hover:text-gray-600 transition-colors"
                                aria-label="Close">
                                <svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em"
                                    fill="currentColor" aria-hidden="true" class="w-4 h-4">
                                    <path
                                        d="M799.86 166.31c.02 0 .04.02.08.06l57.69 57.7c.04.03.05.05.06.08a.12.12 0 010 .06c0 .03-.02.05-.06.09L569.93 512l287.7 287.7c.04.04.05.06.06.09a.12.12 0 010 .07c0 .02-.02.04-.06.08l-57.7 57.69c-.03.04-.05.05-.07.06a.12.12 0 01-.07 0c-.03 0-.05-.02-.09-.06L512 569.93l-287.7 287.7c-.04.04-.06.05-.09.06a.12.12 0 01-.07 0c-.02 0-.04-.02-.08-.06l-57.69-57.7c-.04-.03-.05-.05-.06-.07a.12.12 0 010-.07c0-.03.02-.05.06-.09L454.07 512l-287.7-287.7c-.04-.04-.05-.06-.06-.09a.12.12 0 010-.07c0-.02.02-.04.06-.08l57.7-57.69c.03-.04.05-.05.07-.06a.12.12 0 01.07 0c.03 0 .05.02.09.06L512 454.07l287.7-287.7c.04-.04.06-.05.09-.06a.12.12 0 01.07 0z">
                                    </path>
                                </svg>
                            </button>
                            <div class="flex items-center gap-2">
                                <svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em"
                                    fill="currentColor" aria-hidden="true" class="w-5 h-5 text-gray-700">
                                    <path
                                        d="M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.3 32 32 32h262c17.7 0 32-14.3 32-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V650h182.9v148zm9.6-226.6l-3.5 6.1H414.6l-3.5-6.1L294.2 226h435.4L612.9 571.4z">
                                    </path>
                                </svg>
                                <h3 class="text-base font-semibold text-gray-900">Filter Institutions</h3>
                            </div>
                        </div>
                        <button id="apply-filters"
                            class="px-4 py-2 text-sm font-bold text-white rounded-md transition-all hover:opacity-90"
                            style="background-color: #d82128;">
                            Apply Filters
                        </button>
                    </div>
                </div>

                <!-- Drawer Body -->
                <div class="flex-1 overflow-y-auto p-6">
                    <form class="space-y-6">
                        <!-- Country / Region Filter -->
                        <div class="ant-form-item">
                            <div class="mb-2">
                                <label for="country-filter" class="text-sm font-medium text-gray-700"
                                    title="Country / Region">Country / Region</label>
                            </div>
                            <div>
                                <div class="relative">
                                    <select id="country-filter"
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white cursor-pointer hover:border-gray-400"
                                        style="padding-right: 30px;">
                                        <option value="">All Countries</option>
                                        <option value="au">ðŸ‡¦ðŸ‡º Australia</option>
                                        <option value="uk">ðŸ‡¬ðŸ‡§ United Kingdom</option>
                                        <option value="us">ðŸ‡ºðŸ‡¸ United States</option>
                                        <option value="ca">ðŸ‡¨ðŸ‡¦ Canada</option>
                                        <option value="nz">ðŸ‡³ðŸ‡¿ New Zealand</option>
                                    </select>
                                    <span
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                        <svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em"
                                            fill="currentColor" aria-hidden="true" class="w-3 h-3 text-gray-400">
                                            <path
                                                d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z">
                                            </path>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Partnership Type Filter -->
                        <div class="ant-form-item">
                            <div class="mb-2">
                                <label for="partnership-filter" class="text-sm font-medium text-gray-700"
                                    title="Partnership Type">Partnership Type</label>
                            </div>
                            <div>
                                <div class="relative">
                                    <select id="partnership-filter"
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white cursor-pointer hover:border-gray-400"
                                        style="padding-right: 30px;">
                                        <option value="">All Types</option>
                                        <option value="direct">Direct Partnership</option>
                                        <option value="3rd-party">3rd-party Partnership</option>
                                        <option value="moa">MOA (Memorandum of Agreement)</option>
                                        <option value="strategic">Strategic Partner</option>
                                    </select>
                                    <span
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                        <svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em"
                                            fill="currentColor" aria-hidden="true" class="w-3 h-3 text-gray-400">
                                            <path
                                                d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z">
                                            </path>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Status Filter -->
                        <div class="ant-form-item">
                            <div class="mb-2">
                                <label for="status-filter" class="text-sm font-medium text-gray-700"
                                    title="Status">Status</label>
                            </div>
                            <div>
                                <div class="relative">
                                    <select id="status-filter"
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white cursor-pointer hover:border-gray-400"
                                        style="padding-right: 30px;">
                                        <option value="">All Status</option>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                    <span
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                        <svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em"
                                            fill="currentColor" aria-hidden="true" class="w-3 h-3 text-gray-400">
                                            <path
                                                d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z">
                                            </path>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Divider -->
                        <div class="border-t border-gray-200 my-6"></div>

                        <!-- Institution Tier Filter -->
                        <div class="ant-form-item">
                            <div class="mb-2">
                                <label for="tier-filter" class="text-sm font-medium text-gray-700"
                                    title="Institution Tier">Institution Tier</label>
                            </div>
                            <div>
                                <div class="relative">
                                    <select id="tier-filter"
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white cursor-pointer hover:border-gray-400"
                                        style="padding-right: 30px;">
                                        <option value="">All Tiers</option>
                                        <option value="elite">Elite Admission Scholarship</option>
                                        <option value="premium">Premium Partner</option>
                                        <option value="standard">Standard Partner</option>
                                    </select>
                                    <span
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                        <svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em"
                                            fill="currentColor" aria-hidden="true" class="w-3 h-3 text-gray-400">
                                            <path
                                                d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z">
                                            </path>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Institution Type Filter -->
                        <div class="ant-form-item">
                            <div class="mb-2">
                                <label for="type-filter" class="text-sm font-medium text-gray-700"
                                    title="Institution Type">Institution Type</label>
                            </div>
                            <div>
                                <div class="relative">
                                    <select id="type-filter"
                                        class="w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all appearance-none bg-white cursor-pointer hover:border-gray-400"
                                        style="padding-right: 30px;">
                                        <option value="">All Types</option>
                                        <option value="public">Public University</option>
                                        <option value="private">Private University</option>
                                        <option value="college">College</option>
                                        <option value="community">Community College</option>
                                    </select>
                                    <span
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                        <svg viewBox="64 64 896 896" focusable="false" width="1em" height="1em"
                                            fill="currentColor" aria-hidden="true" class="w-3 h-3 text-gray-400">
                                            <path
                                                d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z">
                                            </path>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Drawer Footer -->
                <div class="flex-shrink-0 border-t border-gray-200 p-4 bg-white">
                    <div class="flex justify-between items-center">
                        <button id="reset-filters"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
                            Reset All
                        </button>
                        <div class="text-xs text-gray-500">
                            <span id="filter-count">0 filters applied</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto px-6 pb-6">
                <!-- Top-level Submenu Tabs -->
                <div class="mb-4 border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6" aria-label="Top tabs">
                        <button class="top-tab-link border-b-2 border-red-500 py-3 text-sm font-medium text-red-600"
                            data-top-tab="institutions">Institutions</button>
                        <button
                            class="top-tab-link border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
                            data-top-tab="tiers">Institution Tiers</button>
                        <button
                            class="top-tab-link border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
                            data-top-tab="intakes">Intakes</button>
                    </nav>
                </div>

                <!-- Panel: Institutions -->
                <section id="panel-institutions" class="top-tab-panel">
                    <!-- Institutions Table -->
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Institution Name</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Country</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Type</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Scholarships</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Status</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <img src="https://ui-avatars.com/api/?name=Tiffin+University&background=d82128&color=fff"
                                                alt="Tiffin University" class="h-8 w-8 rounded-full">
                                            <div class="ml-4">
                                                <div class="text-sm font-medium text-gray-900">Tiffin University</div>
                                                <div class="text-sm text-gray-500">admissions@tiffin.edu</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">United States</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Private University
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">50+ active
                                        scholarships
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="inline-flex items-center gap-2">
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" checked class="sr-only peer">
                                                <div
                                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600">
                                                </div>
                                            </label>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <div class="flex space-x-2">
                                            <button class="text-red-400 hover:text-blue-900"
                                                onclick="openInstitutionDetail()">
                                                <i data-lucide="eye" class="w-4 h-4"></i>
                                            </button>
                                            <button class="text-red-400 hover:text-blue-900"
                                                onclick="openInstitutionEdit()">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button class="text-red-400 hover:text-blue-900">
                                                <i data-lucide="plus-circle" class="w-4 h-4"></i>
                                            </button>
                                            <button class="text-red-600 hover:text-red-900">
                                                <i data-lucide="archive" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Panel: Institution Tiers -->
                <section id="panel-tiers" class="top-tab-panel hidden">
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                        <!-- Header -->
                        <div class="p-6 border-b flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <input type="text" placeholder="Search Institution Tiers..."
                                    class="px-4 py-2 border rounded-lg text-sm w-64" id="tierSearchInput">
                                <button class="px-4 py-2 border rounded-lg text-sm hover:bg-gray-50">
                                    <i data-lucide="search" class="w-4 h-4 inline mr-1"></i>
                                    Filter by Status
                                </button>
                            </div>
                            <button id="addTierBtn" class="px-4 py-2 text-sm text-white rounded-lg"
                                style="background-color:#d82128;">
                                <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                                Add Institution Tier
                            </button>
                        </div>

                        <!-- Table -->
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Name</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Description</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Status</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tiersTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Rows will be rendered by JS -->
                            </tbody>
                        </table>
                        <p id="tiersEmptyState" class="text-sm text-gray-500 p-4 text-center hidden">No tiers yet. Click
                            "Add Institution Tier" to create one.</p>
                    </div>
                </section>

                <!-- Panel: Intakes -->
                <section id="panel-intakes" class="top-tab-panel hidden">
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden p-6">
                        <!-- Header -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Manage Intake Periods</h3>
                            <p class="text-sm text-gray-500">Configure available intake seasons and their enrollment
                                years. Toggle status to activate or deactivate specific intakes.</p>
                        </div>

                        <!-- Unsaved Changes Warning -->
                        <div id="unsavedChangesWarning"
                            class="hidden bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-600 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-yellow-900">You have unsaved changes</p>
                                    <p class="text-xs text-yellow-700">Click "Save Changes" to apply these settings.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Intakes Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <!-- Spring Intake -->
                            <div class="border rounded-lg p-6 hover:shadow-md transition-shadow bg-gray-50">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                                            <i data-lucide="calendar" class="w-6 h-6 text-gray-600"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900">Spring</h4>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="springYear" class="text-xs text-gray-700">Year</label>
                                        <input type="number" id="springYear" value="2026" min="2024" max="2030"
                                            class="w-20 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                                            onchange="markUnsavedChanges()">
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-700">Status</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="springStatus" class="sr-only peer intake-toggle"
                                                data-season="spring" checked>
                                            <div
                                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-gray-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Summer Intake -->
                            <div class="border rounded-lg p-6 hover:shadow-md transition-shadow bg-gray-50">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                                            <i data-lucide="calendar" class="w-6 h-6 text-gray-600"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900">Summer</h4>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="summerYear" class="text-xs text-gray-700">Year</label>
                                        <input type="number" id="summerYear" value="2026" min="2024" max="2030"
                                            class="w-20 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                                            onchange="markUnsavedChanges()">
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-700">Status</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="summerStatus" class="sr-only peer intake-toggle"
                                                data-season="summer" checked>
                                            <div
                                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-gray-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Fall Intake -->
                            <div class="border rounded-lg p-6 hover:shadow-md transition-shadow bg-gray-50">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                                            <i data-lucide="calendar" class="w-6 h-6 text-gray-600"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900">Fall</h4>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="fallYear" class="text-xs text-gray-700">Year</label>
                                        <input type="number" id="fallYear" value="2025" min="2025" max="2030"
                                            class="w-20 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                                            onchange="markUnsavedChanges()">
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-700">Status</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="fallStatus" class="sr-only peer intake-toggle"
                                                data-season="fall">
                                            <div
                                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-gray-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Winter Intake -->
                            <div class="border rounded-lg p-6 hover:shadow-md transition-shadow bg-gray-50">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
                                            <i data-lucide="calendar" class="w-6 h-6 text-gray-600"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900">Winter</h4>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="winterYear" class="text-xs text-gray-700">Year</label>
                                        <input type="number" id="winterYear" value="2025" min="2024" max="2030"
                                            class="w-20 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500"
                                            onchange="markUnsavedChanges()">
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-medium text-gray-700">Status</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="winterStatus" class="sr-only peer intake-toggle"
                                                data-season="winter">
                                            <div
                                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-gray-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Info Banner -->
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                            <div class="flex items-start">
                                <i data-lucide="info" class="w-5 h-5 text-red-600 mr-3 flex-shrink-0 mt-0.5"></i>
                                <div>
                                    <h5 class="text-sm font-medium text-red-900 mb-1">Important: Impact on Student &
                                        Agency Views</h5>
                                    <p class="text-xs text-red-700">Changes to intake settings will affect
                                        <strong>University screen</strong> and <strong>Apply form</strong> pages. Active
                                        intakes will be displayed during the
                                        application process, while inactive intakes will be hidden. Please review
                                        carefully before saving.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex justify-end gap-3">
                            <button type="button" id="saveIntakesBtn" onclick="saveIntakes()"
                                class="px-6 py-2 text-sm font-medium text-white rounded-lg hover:opacity-90"
                                style="background-color: #d82128;">
                                <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                                Save Changes
                            </button>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Institution Detail Drawer -->
            <div id="institution-detail" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
                <div class="absolute right-0 h-full w-3/5 bg-white shadow-xl overflow-y-auto">
                    <div class="p-6 flex flex-col">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 id="drawer-title" class="text-lg font-semibold text-gray-900">Institution Details
                                </h3>
                                <p id="drawer-subtitle" class="text-sm text-gray-500 hidden">Make changes to institution
                                    information</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="edit-toggle-btn" onclick="toggleEditMode()"
                                    class="hidden px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center">
                                    <i data-lucide="edit" class="w-4 h-4 mr-1"></i>
                                    Edit
                                </button>
                                <button id="save-btn" onclick="saveInstitution()"
                                    class="hidden px-3 py-1 text-sm text-white rounded-lg flex items-center"
                                    style="background-color: #d82128;">
                                    <i data-lucide="save" class="w-4 h-4 mr-1"></i>
                                    Save Changes
                                </button>
                                <button id="cancel-btn" onclick="cancelEdit()"
                                    class="hidden px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">
                                    Cancel
                                </button>
                                <button onclick="closeInstitutionDetail()" class="text-gray-500 hover:text-gray-700">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Basic Information -->
                        <div class="mb-6">
                            <div class="flex items-center mb-4">
                                <img src="https://ui-avatars.com/api/?name=Tiffin+University&background=d82128&color=fff"
                                    alt="Tiffin University" class="h-16 w-16 rounded-lg">
                                <div class="ml-4">
                                    <div class="flex items-center space-x-3">
                                        <h4 class="text-xl font-semibold text-gray-900">Tiffin University</h4>
                                        <span
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                                        <span
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">Private</span>
                                        <span
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">Strategic</span>
                                    </div>
                                    <p class="text-sm text-gray-500">Tiffin, Ohio, USA â€¢ Established 1888</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-xs text-gray-500">Location</p>
                                    <div class="view-mode">
                                        <p class="text-sm font-medium text-gray-900">Tiffin, Ohio, USA</p>
                                        <p class="text-xs text-gray-500">155 Miami St, Tiffin, OH 44883</p>
                                    </div>
                                    <div class="edit-mode hidden">
                                        <input type="text"
                                            class="w-full text-sm font-medium border-gray-300 rounded mb-2"
                                            value="Tiffin, Ohio, USA">
                                        <input type="text" class="w-full text-xs border-gray-300 rounded"
                                            value="27 King's College Cir, Toronto, ON M5S">
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-xs text-gray-500">Student Population</p>
                                    <div class="view-mode">
                                        <p class="text-sm font-medium text-gray-900">3,500+</p>
                                        <p class="text-xs text-gray-500">Undergraduate & Graduate</p>
                                    </div>
                                    <div class="edit-mode hidden">
                                        <input type="text"
                                            class="w-full text-sm font-medium border-gray-300 rounded mb-2"
                                            value="97,000+">
                                        <input type="text" class="w-full text-xs border-gray-300 rounded"
                                            value="Undergraduate & Graduate">
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-xs text-gray-500">Website</p>
                                    <div class="view-mode">
                                        <a href="https://www.tiffin.edu"
                                            class="text-sm font-medium text-blue-600 hover:underline">www.tiffin.edu</a>
                                        <p class="text-xs text-gray-500">Official site</p>
                                    </div>
                                    <div class="edit-mode hidden">
                                        <input type="url"
                                            class="w-full text-sm font-medium border-gray-300 rounded mb-2"
                                            value="www.tiffin.edu">
                                        <input type="text" class="w-full text-xs border-gray-300 rounded"
                                            value="Official site">
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-xs text-gray-500">Point of Contact</p>
                                    <div class="view-mode">
                                        <p class="text-sm font-medium text-gray-900">Office of Financial Aid</p>
                                        <p class="text-xs text-gray-500">finaid@tiffin.edu â€¢ +1 419-448-3279</p>
                                    </div>
                                    <div class="edit-mode hidden">
                                        <input type="text"
                                            class="w-full text-sm font-medium border-gray-300 rounded mb-2"
                                            value="Office of Financial Aid">
                                        <div class="flex space-x-2">
                                            <input type="email" class="flex-1 text-xs border-gray-300 rounded"
                                                value="finaid@tiffin.edu">
                                            <input type="tel" class="flex-1 text-xs border-gray-300 rounded"
                                                value="+1 419-448-3279">
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-xs text-gray-500">Partner Type</p>
                                    <div class="view-mode">
                                        <p class="text-sm font-medium text-gray-900">MOA â€¢ Strategic</p>
                                        <p class="text-xs text-gray-500">Direct Partnership</p>
                                    </div>
                                    <div class="edit-mode hidden">
                                        <select class="w-full text-sm font-medium border-gray-300 rounded mb-2">
                                            <option value="moa-strategic" selected>MOA â€¢ Strategic</option>
                                            <option value="moa">MOA</option>
                                            <option value="referral">Referral</option>
                                            <option value="strategic">Strategic</option>
                                        </select>
                                        <input type="text" class="w-full text-xs border-gray-300 rounded"
                                            value="Direct Partnership">
                                    </div>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-xs text-gray-500">Established Year</p>
                                    <div class="view-mode">
                                        <p class="text-sm font-medium text-gray-900">1888</p>
                                        <p class="text-xs text-gray-500">Historic Institution</p>
                                    </div>
                                    <div class="edit-mode hidden">
                                        <input type="number"
                                            class="w-full text-sm font-medium border-gray-300 rounded mb-2"
                                            value="1827">
                                        <input type="text" class="w-full text-xs border-gray-300 rounded"
                                            value="Historic Institution">
                                    </div>
                                </div>

                                <!-- Optional: Partner University Checkbox -->
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-xs text-gray-500">Partner University</p>
                                    <div class="view-mode">
                                        <p class="text-sm font-medium text-gray-900">No</p>
                                        <p class="text-xs text-gray-500">Mark if this institution is a partner
                                            university</p>
                                    </div>
                                    <div class="edit-mode hidden">
                                        <label class="inline-flex items-center gap-2 text-sm text-gray-900">
                                            <input type="checkbox" id="isPartnerUniversity"
                                                class="h-4 w-4 rounded border-gray-300">
                                            Partner University
                                        </label>
                                        <div id="partnerBriefContainer" class="mt-3 hidden">
                                            <label for="partnerBrief" class="block text-xs text-gray-500 mb-1">Partner
                                                Brief</label>
                                            <textarea id="partnerBrief" rows="3"
                                                placeholder="Short brief about this partner..."
                                                class="w-full text-xs border border-gray-300 rounded p-2"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tabs Navigation -->
                        <div class="mb-4 border-b border-gray-200">
                            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                                <button class="tab-link border-b-2 border-red-500 py-3 text-sm font-medium text-red-600"
                                    data-tab="overview">Overview</button>
                                <button
                                    class="tab-link border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
                                    data-tab="programs">Scholarships</button>
                                <button
                                    class="tab-link border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
                                    data-tab="admissions">Admission Requirements</button>
                                <button
                                    class="tab-link border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
                                    data-tab="campus">Campus Life</button>
                                <button
                                    class="tab-link border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300"
                                    data-tab="costs">Cost and Tuition</button>
                            </nav>
                        </div>

                        <!-- Tab Panels -->
                        <div class="flex-1">
                            <!-- Overview Tab -->
                            <section id="tab-overview" class="tab-panel">
                                <div class="space-y-6">
                                    <div>
                                        <h4 class="font-semibold text-gray-900 mb-2">About</h4>
                                        <div class="view-mode">
                                            <p class="text-sm text-gray-700">Tiffin University is a private university
                                                located in Tiffin, Ohio. Founded in 1888, TU is committed to
                                                transforming
                                                lives through education and providing students with challenging academic
                                                scholarships that enhance their global competencies and skills for
                                                success in a
                                                diverse world.</p>
                                        </div>
                                        <div class="edit-mode hidden">
                                            <textarea
                                                class="w-full text-sm border-gray-300 rounded-lg p-2 h-16">Tiffin University is a private university located in Tiffin, Ohio. Founded in 1888, TU is committed to transforming lives through education and providing students with challenging academic scholarships that enhance their global competencies and skills for success in a diverse world.</textarea>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900 mb-2">Mission Statement</h4>
                                        <div class="view-mode">
                                            <p class="text-sm text-gray-700">Follow a path. Blaze a trail. Tiffin
                                                University
                                                represents who you are now and who you will become. We challenge
                                                students to
                                                enhance their global competencies and skills for success in a diverse
                                                world.
                                            </p>
                                        </div>
                                        <div class="edit-mode hidden">
                                            <textarea
                                                class="w-full text-sm border-gray-300 rounded-lg p-2 h-16">Follow a path. Blaze a trail. Tiffin University represents who you are now and who you will become. We challenge students to enhance their global competencies and skills for success in a diverse world.</textarea>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Scholarships Tab -->
                            <section id="tab-programs" class="tab-panel hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="font-semibold text-gray-900">Scholarships</h4>
                                    <div class="flex items-center space-x-2">
                                        <button
                                            class="text-sm border px-3 py-1 rounded-lg hover:bg-gray-50 flex items-center">
                                            <i data-lucide="link" class="w-4 h-4 mr-1"></i>
                                            Link Scholarships
                                        </button>
                                        <button class="text-sm text-white px-3 py-1 rounded-lg flex items-center"
                                            style="background-color:#d82128;">
                                            <i data-lucide="plus" class="w-4 h-4 mr-1"></i>
                                            Add Scholarships
                                        </button>
                                    </div>
                                </div>

                                <div class="space-y-4">
                                    <!-- Scholarship Item -->
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex justify-between items-start">
                                            <div class="w-full">
                                                <!-- View Mode -->
                                                <div class="view-mode">
                                                    <h5 class="text-sm font-medium text-gray-900">Merit Scholarships
                                                        2025</h5>
                                                    <p class="text-sm text-gray-500">Undergraduate</p>
                                                    <p class="text-sm text-gray-500 mt-1">Tuition: $28,000 - $32,000 /
                                                        year</p>
                                                </div>

                                                <!-- Edit Mode -->
                                                <div class="edit-mode hidden space-y-2">
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="Merit Scholarships">
                                                    <select class="w-full text-sm border-gray-300 rounded p-1">
                                                        <option>Undergraduate</option>
                                                        <option>Graduate</option>
                                                        <option>PhD</option>
                                                    </select>
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="$28,000 - $32,000 / year">
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="Rolling Admissions">
                                                    <textarea
                                                        class="w-full text-sm border-gray-300 rounded p-2 mt-2 h-20">IELTS: 6.0
GPA: 2.5
Fall 2025
Spring 2026</textarea>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button class="edit-btn text-gray-400 hover:text-gray-600">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </button>
                                                <button class="save-btn hidden text-green-600 hover:text-green-800">
                                                    <i data-lucide="check" class="w-4 h-4"></i>
                                                </button>
                                                <button class="text-gray-400 hover:text-gray-600">
                                                    <i data-lucide="archive" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="view-mode">
                                            <div class="mt-3 flex flex-wrap gap-2">
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">IELTS:
                                                    6.0</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">GPA:
                                                    2.5</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">Fall
                                                    2025</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">Spring
                                                    2026</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Business Management Scholarship -->
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex justify-between items-start">
                                            <div class="w-full">
                                                <!-- View Mode -->
                                                <div class="view-mode">
                                                    <h5 class="text-sm font-medium text-gray-900">Athletic Scholarships
                                                        2025</h5>
                                                    <p class="text-sm text-gray-500">Undergraduate</p>
                                                    <p class="text-sm text-gray-500 mt-1">Tuition: $28,000 - $32,000 /
                                                        year</p>
                                                </div>

                                                <!-- Edit Mode -->
                                                <div class="edit-mode hidden space-y-2">
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="Athletic Scholarships">
                                                    <select class="w-full text-sm border-gray-300 rounded p-1">
                                                        <option>Undergraduate</option>
                                                        <option>Graduate</option>
                                                        <option>PhD</option>
                                                    </select>
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="$28,000 - $32,000 / year">
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="Rolling Admissions">
                                                    <textarea
                                                        class="w-full text-sm border-gray-300 rounded p-2 mt-2 h-20">IELTS: 6.0
GPA: 2.5
Fall 2025
Spring 2026</textarea>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button class="edit-btn text-gray-400 hover:text-gray-600">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </button>
                                                <button class="save-btn hidden text-green-600 hover:text-green-800">
                                                    <i data-lucide="check" class="w-4 h-4"></i>
                                                </button>
                                                <button class="text-gray-400 hover:text-gray-600">
                                                    <i data-lucide="archive" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="view-mode">
                                            <div class="mt-3 flex flex-wrap gap-2">
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">IELTS:
                                                    6.0</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">GPA:
                                                    2.5</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">Fall
                                                    2025</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">Spring
                                                    2026</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Arts Scholarship -->
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex justify-between items-start">
                                            <div class="w-full">
                                                <!-- View Mode -->
                                                <div class="view-mode">
                                                    <h5 class="text-sm font-medium text-gray-900">Arts Scholarships 2025
                                                    </h5>
                                                    <p class="text-sm text-gray-500">Undergraduate</p>
                                                    <p class="text-sm text-gray-500 mt-1">Tuition: $28,000 - $32,000 /
                                                        year</p>
                                                </div>

                                                <!-- Edit Mode -->
                                                <div class="edit-mode hidden space-y-2">
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="Arts Scholarships">
                                                    <select class="w-full text-sm border-gray-300 rounded p-1">
                                                        <option>Undergraduate</option>
                                                        <option>Graduate</option>
                                                        <option>PhD</option>
                                                    </select>
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="$28,000 - $32,000 / year">
                                                    <input type="text"
                                                        class="w-full text-sm border-gray-300 rounded p-1"
                                                        value="Rolling Admissions">
                                                    <textarea
                                                        class="w-full text-sm border-gray-300 rounded p-2 mt-2 h-20">IELTS: 6.0
GPA: 2.5
Fall 2025
Spring 2026</textarea>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button class="edit-btn text-gray-400 hover:text-gray-600">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </button>
                                                <button class="save-btn hidden text-green-600 hover:text-green-800">
                                                    <i data-lucide="check" class="w-4 h-4"></i>
                                                </button>
                                                <button class="text-gray-400 hover:text-gray-600">
                                                    <i data-lucide="archive" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="view-mode">
                                            <div class="mt-3 flex flex-wrap gap-2">
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">IELTS:
                                                    6.0</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">GPA:
                                                    2.5</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">Fall
                                                    2025</span>
                                                <span
                                                    class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">Spring
                                                    2026</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Admissions Tab -->
                            <section id="tab-admissions" class="tab-panel hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="font-semibold text-gray-900">Admission Requirements</h4>
                                </div>
                                <div class="space-y-6">
                                    <div>
                                        <div class="view-mode">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <!-- Bachelor Column -->
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-3">Master
                                                    </h5>
                                                    <div class="mb-3">
                                                        <p class="text-xs text-gray-500">English Language</p>
                                                        <ul class="text-sm text-gray-700 space-y-1">
                                                            <li>â€¢ IELTS: 6.0 overall (5.5 minimum per band)</li>
                                                            <li>â€¢ TOEFL iBT: 79 overall (19 minimum per section)</li>
                                                            <li>â€¢ Duolingo: 105 overall</li>
                                                            <li>â€¢ PTE Academic: 53 overall</li>
                                                        </ul>
                                                    </div>
                                                    <div>
                                                        <p class="text-xs text-gray-500">Academic Requirements</p>
                                                        <ul class="text-sm text-gray-700 space-y-1">
                                                            <li>â€¢ Undergraduate: GPA 2.5+ (70%+)</li>
                                                            <li>â€¢ High School Diploma or equivalent</li>
                                                            <li>â€¢ Rolling admissions - no strict deadline</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <!-- Bachelor Column -->
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-3">Bachelor
                                                    </h5>
                                                    <div class="mb-3">
                                                        <p class="text-xs text-gray-500">English Language</p>
                                                        <ul class="text-sm text-gray-700 space-y-1">
                                                            <li>â€¢ IELTS: 6.0 overall (5.5 minimum per band)</li>
                                                            <li>â€¢ TOEFL iBT: 79 overall (19 minimum per section)</li>
                                                            <li>â€¢ Duolingo: 105 overall</li>
                                                            <li>â€¢ PTE Academic: 53 overall</li>
                                                        </ul>
                                                    </div>
                                                    <div>
                                                        <p class="text-xs text-gray-500">Academic Requirements</p>
                                                        <ul class="text-sm text-gray-700 space-y-1">
                                                            <li>â€¢ Undergraduate: GPA 2.5+ (70%+)</li>
                                                            <li>â€¢ High School Diploma or equivalent</li>
                                                            <li>â€¢ Rolling admissions - no strict deadline</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="edit-mode hidden">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <!-- Master Column Edit -->
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-3">Master</h5>
                                                    <label class="block text-xs text-gray-500 mb-1">English
                                                        Language</label>
                                                    <textarea
                                                        class="w-full h-24 text-sm border-gray-300 rounded p-2 mb-3">
                                                        â€¢ IELTS: 6.0 overall (5.5 minimum per band)
                                                        â€¢ TOEFL iBT: 79 overall (19 minimum per section)
                                                        â€¢ Duolingo: 105 overall
                                                        â€¢ PTE Academic: 53 overall</textarea>
                                                    <label class="block text-xs text-gray-500 mb-1">Academic
                                                        Requirements</label>
                                                    <textarea class="w-full h-24 text-sm border-gray-300 rounded p-2">
                                                        â€¢ Graduate: GPA 3.0+ (B average)
                                                        â€¢ Bachelor's degree or equivalent</textarea>
                                                </div>
                                                <!-- Bachelor Column Edit -->
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-3">Bachelor
                                                    </h5>
                                                    <label class="block text-xs text-gray-500 mb-1">English
                                                        Language</label>
                                                    <textarea
                                                        class="w-full h-24 text-sm border-gray-300 rounded p-2 mb-3">
                                                        â€¢ IELTS: 6.0 overall (5.5 minimum per band)
                                                        â€¢ TOEFL iBT: 79 overall (19 minimum per section)
                                                        â€¢ Duolingo: 105 overall
                                                        â€¢ PTE Academic: 53 overall</textarea>
                                                    <label class="block text-xs text-gray-500 mb-1">Academic
                                                        Requirements</label>
                                                    <textarea class="w-full h-24 text-sm border-gray-300 rounded p-2">
                                                        â€¢ Undergraduate: GPA 2.5+ (70%+)
                                                        â€¢ High School Diploma or equivalent
                                                        â€¢ Rolling admissions - no strict deadline</textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900 mb-3">Required Documents</h4>
                                        <div class="view-mode">
                                            <div class="bg-gray-50 rounded-lg p-4">
                                                <ul class="text-sm text-gray-700 space-y-2">
                                                    <li>â€¢ Official transcripts and certificates</li>
                                                    <li>â€¢ English language test scores</li>
                                                    <li>â€¢ Statement of purpose / Personal statement</li>
                                                    <li>â€¢ Letters of recommendation (2-3)</li>
                                                    <li>â€¢ Resume/CV</li>
                                                    <li>â€¢ Portfolio (for applicable scholarships)</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="edit-mode hidden">
                                            <div class="bg-gray-50 rounded-lg p-4">
                                                <textarea class="w-full h-40 text-sm border-gray-300 rounded p-2">
                                                    â€¢ Official transcripts and certificates
                                                    â€¢ English language test scores
                                                    â€¢ Statement of purpose / Personal statement
                                                    â€¢ Letters of recommendation (2-3)
                                                    â€¢ Resume/CV
                                                    â€¢ Portfolio (for applicable scholarships)</textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900 mb-3">International Student Requirements
                                        </h4>
                                        <div class="view-mode">
                                            <div class="bg-gray-50 rounded-lg p-4">
                                                <ul class="text-sm text-gray-700 space-y-2">
                                                    <li>â€¢ Proof of financial support (CAD $60,000+ per year)</li>
                                                    <li>â€¢ Study permit application</li>
                                                    <li>â€¢ Medical examination (if required)</li>
                                                    <li>â€¢ Visa support letter provided upon admission</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="edit-mode hidden">
                                            <div class="bg-gray-50 rounded-lg p-4">
                                                <textarea class="w-full h-32 text-sm border-gray-300 rounded p-2">
                                                    â€¢ Proof of financial support (CAD $60,000+ per year)
                                                    â€¢ Study permit application
                                                    â€¢ Medical examination (if required)
                                                    â€¢ Visa support letter provided upon admission</textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="edit-mode hidden flex justify-end space-x-2">
                                    </div>
                                </div>
                            </section>

                            <!-- Campus Life Tab -->
                            <section id="tab-campus" class="tab-panel hidden">
                                <div class="space-y-6">
                                    <div class="relative">
                                        <div class="flex justify-between items-center mb-3">
                                            <h4 class="font-semibold text-gray-900">Student Activities</h4>
                                        </div>
                                        <div class="view-mode">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Clubs &
                                                        Organizations</h5>
                                                    <ul class="text-sm text-gray-700 space-y-1">
                                                        <li>â€¢ 800+ student clubs and organizations</li>
                                                        <li>â€¢ Academic and professional societies</li>
                                                        <li>â€¢ Cultural and international student groups</li>
                                                        <li>â€¢ Volunteer and community service groups</li>
                                                    </ul>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Sports &
                                                        Recreation</h5>
                                                    <ul class="text-sm text-gray-700 space-y-1">
                                                        <li>â€¢ Varsity Blues athletics scholarship</li>
                                                        <li>â€¢ Intramural and recreational sports</li>
                                                        <li>â€¢ Athletic Centre with modern facilities</li>
                                                        <li>â€¢ Outdoor recreation scholarships</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="edit-mode hidden">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Clubs &
                                                        Organizations</h5>
                                                    <textarea class="w-full h-32 text-sm border-gray-300 rounded p-2">â€¢ 800+ student clubs and organizations
â€¢ Academic and professional societies
â€¢ Cultural and international student groups
â€¢ Volunteer and community service groups</textarea>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Sports &
                                                        Recreation</h5>
                                                    <textarea class="w-full h-32 text-sm border-gray-300 rounded p-2">â€¢ Varsity Blues athletics scholarship
â€¢ Intramural and recreational sports
â€¢ Athletic Centre with modern facilities
â€¢ Outdoor recreation scholarships</textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="relative">
                                        <div class="flex justify-between items-center mb-3">
                                            <h4 class="font-semibold text-gray-900">Campus Facilities</h4>
                                        </div>
                                        <div class="view-mode">
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Academic</h5>
                                                    <ul class="text-sm text-gray-700 space-y-1">
                                                        <li>â€¢ Robarts Research Library</li>
                                                        <li>â€¢ 40+ specialized libraries</li>
                                                        <li>â€¢ Research laboratories</li>
                                                        <li>â€¢ Computer labs</li>
                                                    </ul>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Housing</h5>
                                                    <ul class="text-sm text-gray-700 space-y-1">
                                                        <li>â€¢ 12 residence buildings</li>
                                                        <li>â€¢ Graduate housing available</li>
                                                        <li>â€¢ Family housing options</li>
                                                        <li>â€¢ Off-campus housing support</li>
                                                    </ul>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Services</h5>
                                                    <ul class="text-sm text-gray-700 space-y-1">
                                                        <li>â€¢ Health & Wellness Centre</li>
                                                        <li>â€¢ Career Centre</li>
                                                        <li>â€¢ International Student Centre</li>
                                                        <li>â€¢ Accessibility Services</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="edit-mode hidden">
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Academic</h5>
                                                    <textarea class="w-full h-32 text-sm border-gray-300 rounded p-2">â€¢ Robarts Research Library
â€¢ 40+ specialized libraries
â€¢ Research laboratories
â€¢ Computer labs</textarea>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Housing</h5>
                                                    <textarea class="w-full h-32 text-sm border-gray-300 rounded p-2">â€¢ 12 residence buildings
â€¢ Graduate housing available
â€¢ Family housing options
â€¢ Off-campus housing support</textarea>
                                                </div>
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Services</h5>
                                                    <textarea class="w-full h-32 text-sm border-gray-300 rounded p-2">â€¢ Health & Wellness Centre
â€¢ Career Centre
â€¢ International Student Centre
â€¢ Accessibility Services</textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>

                            <!-- Cost and Tuition Tab -->
                            <section id="tab-costs" class="tab-panel hidden">
                                <div class="space-y-6">
                                    <!-- Tuition & Application (Application Fee + Tuition & Fees) -->
                                    <div style="background: rgb(249, 250, 251); padding: 16px; border-radius: 8px;">
                                        <h4 class="font-semibold text-gray-900 mb-4">Tuition & Application</h4>


                                        <!-- Tuition & Fees moved here -->
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Tuition &
                                                Fees</label>
                                            <div class="view-mode">
                                                <p class="text-sm text-gray-700">$34,000 - $38,000 per year</p>
                                            </div>
                                            <div class="edit-mode hidden">
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <input type="number" placeholder="Min"
                                                        class="w-full px-3 py-2 text-sm border-gray-300 rounded"
                                                        value="34000">
                                                    <span
                                                        style="color: rgb(153, 153, 153); font-size: 16px; font-weight: 500;">-</span>
                                                    <input type="number" placeholder="Max"
                                                        class="w-full px-3 py-2 text-sm border-gray-300 rounded"
                                                        value="38000">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Application Fee
                                                (Part of Ellacy Program)</label>
                                            <div class="view-mode">
                                                <p class="text-sm text-gray-700">$50</p>
                                            </div>
                                            <div class="edit-mode hidden">
                                                <input type="number" placeholder="Enter application fee"
                                                    class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="50">
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Living Costs -->
                                    <div style="background: rgb(249, 250, 251); padding: 16px; border-radius: 8px;">
                                        <h4 class="font-semibold text-gray-900 mb-4">Living Costs</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Living
                                                    Expenses (Housing and Food) - Per Year</label>
                                                <div class="view-mode">
                                                    <p class="text-sm text-gray-700">$12,000 - $15,000</p>
                                                </div>
                                                <div class="edit-mode hidden">
                                                    <input type="number" placeholder="Enter housing cost"
                                                        class="w-full px-3 py-2 text-sm border-gray-300 rounded"
                                                        value="12000">
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Books &
                                                    Supplies - Per Year</label>
                                                <div class="view-mode">
                                                    <p class="text-sm text-gray-700">$1,200 - $1,500</p>
                                                </div>
                                                <div class="edit-mode hidden">
                                                    <input type="number" placeholder="Enter books cost"
                                                        class="w-full px-3 py-2 text-sm border-gray-300 rounded"
                                                        value="1200">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Other Expenses -->
                                    <div style="background: rgb(249, 250, 251); padding: 16px; border-radius: 8px;">
                                        <h4 class="font-semibold text-gray-900 mb-4">Other Expenses (USD)</h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label
                                                    class="block text-sm font-medium text-gray-700 mb-2">Transportation
                                                    - Per Year</label>
                                                <div class="view-mode">
                                                    <p class="text-sm text-gray-700">$800 - $1,200</p>
                                                </div>
                                                <div class="edit-mode hidden">
                                                    <input type="number" placeholder="Enter transportation cost"
                                                        class="w-full px-3 py-2 text-sm border-gray-300 rounded"
                                                        value="800">
                                                </div>
                                            </div>
                                            <div>
                                                <label
                                                    class="block text-sm font-medium text-gray-700 mb-2">Miscellaneous
                                                    Personal Expenses - Per Year</label>
                                                <div class="view-mode">
                                                    <p class="text-sm text-gray-700">$2,000 - $3,000</p>
                                                </div>
                                                <div class="edit-mode hidden">
                                                    <input type="number" placeholder="Enter personal expenses"
                                                        class="w-full px-3 py-2 text-sm border-gray-300 rounded"
                                                        value="2000">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <!-- Admin Actions -->
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <div class="flex flex-wrap gap-2">

                                <button
                                    class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center">
                                    <i data-lucide="link" class="w-4 h-4 mr-1"></i>
                                    Link Scholarships
                                </button>
                                <button
                                    class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center">
                                    <i data-lucide="users" class="w-4 h-4 mr-1"></i>
                                    Associate Advisors
                                </button>
                                <button
                                    class="px-3 py-2 text-sm border border-red-300 text-red-600 rounded-lg hover:bg-red-50 flex items-center">
                                    <i data-lucide="archive" class="w-4 h-4 mr-1"></i>
                                    Archive Institution
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Institution Enhanced Flow Modal -->
            <div id="add-institution-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
                <div
                    class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[800px] bg-white rounded-lg shadow-xl">
                    <div class="p-6">
                        <!-- Step Indicator -->
                        <div class="mb-6">
                            <div class="flex items-center justify-center space-x-4">
                                <div class="flex items-center">
                                    <div id="step-1-indicator"
                                        class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium text-white"
                                        style="background-color: #d82128;">1</div>
                                    <span class="ml-2 text-sm font-medium text-gray-900">Initial Info</span>
                                </div>
                                <div class="w-16 h-1 bg-gray-200">
                                    <div id="progress-1-2" class="h-1 bg-gray-200 transition-all duration-300"></div>
                                </div>
                                <div class="flex items-center">
                                    <div id="step-2-indicator"
                                        class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-500">
                                        2</div>
                                    <span class="ml-2 text-sm font-medium text-gray-500">AI Fetch</span>
                                </div>
                                <div class="w-16 h-1 bg-gray-200">
                                    <div id="progress-2-3" class="h-1 bg-gray-200 transition-all duration-300"></div>
                                </div>
                                <div class="flex items-center">
                                    <div id="step-3-indicator"
                                        class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-500">
                                        3</div>
                                    <span class="ml-2 text-sm font-medium text-gray-500">Review & Save</span>
                                </div>
                            </div>
                        </div>

                        <!-- Step 1: Initial Form -->
                        <div id="step-1" class="step-content">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Add New Institution</h3>
                                    <p class="text-sm text-gray-500">Enter basic info or paste a URL to fetch details
                                        automatically.</p>
                                </div>
                                <button onclick="closeAddInstitutionModal()" class="text-gray-500 hover:text-gray-700">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>

                            <form id="initial-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Institution Name <span
                                            class="text-red-500">*</span></label>
                                    <input id="institution-name" type="text" class="w-full rounded-lg border-gray-300"
                                        placeholder="e.g., University of Toronto" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Institution Website URL
                                        <span class="text-red-500">*</span></label>
                                    <input id="institution-url" type="url" class="w-full rounded-lg border-gray-300"
                                        placeholder="https://www.university.edu" required>
                                    <p class="text-xs text-gray-500 mt-1">Used to automatically fetch information about
                                        the university</p>
                                </div>
                                <div class="flex justify-end space-x-3 pt-4">
                                    <button type="button" onclick="closeAddInstitutionModal()"
                                        class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">Cancel</button>
                                    <button type="button" onclick="fetchInstitutionInfo()"
                                        class="px-4 py-2 text-white rounded-lg text-sm font-medium hover:opacity-90 flex items-center"
                                        style="background-color: #d82128;">
                                        <i data-lucide="zap" class="w-4 h-4 mr-2"></i>
                                        Fetch Info
                                    </button>
                                    <button type="button" onclick="skipToManualEntry()"
                                        class="ml-2 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
                                        Skip to Review
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Step 2: AI-Assisted Data Fetch -->
                        <div id="step-2" class="step-content hidden">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Fetching Information</h3>
                                    <p class="text-sm text-gray-500">AI is gathering data from the university website
                                    </p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button onclick="skipToManualEntry()"
                                        class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">
                                        Skip to Review
                                    </button>
                                    <button onclick="closeAddInstitutionModal()"
                                        class="text-gray-500 hover:text-gray-700">
                                        <i data-lucide="x" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="text-center py-12">
                                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full mb-4"
                                    style="background-color: #FEF2F2;">
                                    <div
                                        class="animate-spin w-8 h-8 border-2 border-red-200 border-t-red-600 rounded-full">
                                    </div>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900 mb-2">Fetching information...</h4>
                                <p id="fetch-status" class="text-sm text-gray-500">Fetching information from <span
                                        class="font-medium">university website</span>...</p>

                                <div class="mt-6 max-w-md mx-auto">
                                    <div class="bg-gray-100 rounded-lg p-4 text-left">
                                        <h5 class="text-sm font-medium text-gray-900 mb-2">Gathering data for:</h5>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li class="flex items-center">
                                                <i data-lucide="check" class="w-4 h-4 text-green-500 mr-2"></i>
                                                Logo and branding
                                            </li>
                                            <li class="flex items-center">
                                                <i data-lucide="check" class="w-4 h-4 text-green-500 mr-2"></i>
                                                Location and contact info
                                            </li>
                                            <li class="flex items-center">
                                                <i data-lucide="loader"
                                                    class="w-4 h-4 text-blue-500 mr-2 animate-spin"></i>
                                                Overview and description
                                            </li>
                                            <li class="flex items-center">
                                                <i data-lucide="clock" class="w-4 h-4 text-gray-400 mr-2"></i>
                                                Scholarships and courses
                                            </li>
                                            <li class="flex items-center">
                                                <i data-lucide="clock" class="w-4 h-4 text-gray-400 mr-2"></i>
                                                Admission requirements
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <button onclick="skipToManualEntry()"
                                    class="mt-6 text-sm text-gray-500 hover:text-gray-700 underline">
                                    Skip and enter manually
                                </button>
                            </div>
                        </div>

                        <!-- Step 3: Review & Edit -->
                        <div id="step-3" class="step-content hidden">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Review & Edit Institution</h3>
                                    <p class="text-sm text-gray-500">
                                        <i data-lucide="zap" class="w-4 h-4 inline mr-1 text-yellow-500"></i>
                                        AI-scraped content. Please verify before saving.
                                    </p>
                                </div>
                                <button onclick="closeAddInstitutionModal()" class="text-gray-500 hover:text-gray-700">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>

                            <!-- This will be populated with the editable institution detail view -->
                            <div id="review-content" class="">
                                <!-- Content will be dynamically populated -->
                            </div>

                            <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                                <button onclick="goBackToStep2()"
                                    class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center">
                                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                                    Back
                                </button>
                                <div class="flex space-x-3">
                                    <button onclick="closeAddInstitutionModal()"
                                        class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
                                        Cancel
                                    </button>
                                    <button onclick="saveNewInstitution()"
                                        class="px-4 py-2 text-white rounded-lg text-sm font-medium hover:opacity-90 flex items-center"
                                        style="background-color: #d82128;">
                                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                        Save Institution
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Assistant Floating Button -->
    <div id="ai-assistant" class="fixed bottom-6 right-6 z-50">
        <button id="ai-toggle"
            class="w-14 h-14 rounded-full text-white shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center"
            style="background-color: #d82128;">
            <i data-lucide="message-circle" class="w-6 h-6"></i>
        </button>

        <!-- AI Chat Panel -->
        <div id="ai-chat-panel"
            class="hidden absolute bottom-16 right-0 w-80 h-96 bg-white shadow-xl border border-gray-200">
            <!-- Chat Header -->
            <div class="flex items-center justify-between p-4 border-b border-gray-200"
                style="background-color: #d82128;">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center mr-3">
                        <i data-lucide="bot" class="w-4 h-4" style="color: #d82128;"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium text-white">AI Assistant</h3>
                        <p class="text-xs text-red-100">Online</p>
                    </div>
                </div>
                <button id="ai-close" class="text-white hover:text-red-100">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>

            <!-- Chat Messages -->
            <div id="chat-messages" class="flex-1 p-4 h-64 overflow-y-auto">
                <div class="mb-4">
                    <div class="flex items-start">
                        <div class="w-6 h-6 rounded-full bg-red-100 flex items-center justify-center mr-2 mt-1">
                            <i data-lucide="bot" class="w-3 h-3" style="color: #d82128;"></i>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-sm text-gray-800">Hello! I can help you analyze partner institutions,
                                optimize scholarship offerings, and provide partnership insights. What would you like to
                                know?</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center">
                    <input type="text" id="chat-input" placeholder="Ask about institutions..."
                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <button id="send-message" class="ml-2 p-2 rounded-lg text-white" style="background-color: #d82128;">
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Partner Upsert Modal (used by upsertPartner()) -->
    <div id="partnerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[720px] bg-white rounded-lg shadow-xl">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 id="partnerModalTitle" class="text-lg font-semibold text-gray-900">Add Partner</h3>
                <button id="partnerCloseX" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Logo URL</label>
                    <input id="partnerLogo" type="url" class="w-full border rounded-lg px-3 py-2 text-sm"
                        placeholder="https://...">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input id="partnerName" type="text" class="w-full border rounded-lg px-3 py-2 text-sm"
                            placeholder="Institution name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                        <input id="partnerLocation" type="text" class="w-full border rounded-lg px-3 py-2 text-sm"
                            placeholder="City, Country">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea id="partnerDesc" class="w-full border rounded-lg px-3 py-2 text-sm h-24"
                        placeholder="Short description"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Hashtags (comma separated)</label>
                    <input id="partnerTags" type="text" class="w-full border rounded-lg px-3 py-2 text-sm"
                        placeholder="2+2, Exchange, ...">
                </div>
                <input id="partnerIndex" type="hidden" value="">
            </div>
            <div class="p-4 border-t flex justify-end gap-2">
                <button id="partnerCancel" class="px-4 py-2 text-sm border rounded-lg hover:bg-gray-50">Cancel</button>
                <button id="partnerSave" class="px-4 py-2 text-sm text-white rounded-lg"
                    style="background-color:#d82128;">Save</button>
            </div>
        </div>
    </div>

    <!-- Partner Selection Modal -->
    <div id="partnerSelectModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[720px] bg-white rounded-lg shadow-xl">
            <div class="p-6 border-b flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900">Select Institution</h3>
                <button id="partnerSelectCloseX" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <div class="relative">
                        <i data-lucide="search"
                            class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input id="institutionSelectSearch" type="text" placeholder="Search institutions..."
                            class="pl-9 pr-3 py-2 w-full border rounded-lg text-sm">
                    </div>
                </div>
                <div class="max-h-80 overflow-y-auto">
                    <ul id="institutionSelectList" class="divide-y divide-gray-100"></ul>
                </div>
            </div>
            <div class="p-4 border-t flex justify-end">
                <button id="partnerSelectCancel"
                    class="px-4 py-2 text-sm border rounded-lg hover:bg-gray-50">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Profile dropdown functionality
        const profileMenu = document.getElementById('profile-menu');
        const profileDropdown = document.getElementById('profile-dropdown');

        if (profileMenu && profileDropdown) {
            profileMenu.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                profileDropdown.classList.add('hidden');
            });

            profileDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }

        // Institution detail drawer functionality
        let isEditMode = false;

        function openInstitutionDetail() {
            setViewMode();
            document.getElementById('institution-detail').classList.remove('hidden');
        }

        function openInstitutionEdit() {
            setEditMode();
            document.getElementById('institution-detail').classList.remove('hidden');
        }

        function closeInstitutionDetail() {
            document.getElementById('institution-detail').classList.add('hidden');
            setViewMode(); // Reset to view mode when closing
        }

        function setViewMode() {
            isEditMode = false;

            // Update header
            document.getElementById('drawer-title').textContent = 'Institution Details';
            document.getElementById('drawer-subtitle').classList.add('hidden');

            // Show/hide buttons
            document.getElementById('edit-toggle-btn').classList.remove('hidden');
            document.getElementById('save-btn').classList.add('hidden');
            document.getElementById('cancel-btn').classList.add('hidden');

            // Show view mode, hide edit mode
            document.querySelectorAll('.view-mode').forEach(el => el.classList.remove('hidden'));
            document.querySelectorAll('.edit-mode').forEach(el => el.classList.add('hidden'));
        }

        function setEditMode() {
            isEditMode = true;

            // Update header
            document.getElementById('drawer-title').textContent = 'Edit Institution';
            document.getElementById('drawer-subtitle').classList.remove('hidden');

            // Show/hide buttons
            document.getElementById('edit-toggle-btn').classList.add('hidden');
            document.getElementById('save-btn').classList.remove('hidden');
            document.getElementById('cancel-btn').classList.remove('hidden');

            // Show edit mode, hide view mode
            document.querySelectorAll('.view-mode').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.edit-mode').forEach(el => el.classList.remove('hidden'));
        }

        function toggleEditMode() {
            if (isEditMode) {
                setViewMode();
            } else {
                setEditMode();
            }
        }

        function saveInstitution() {
            // Here you would typically send the data to the server
            // For now, we'll just show a success message and switch back to view mode

            // Simulate saving
            setTimeout(() => {
                setViewMode();
                showNotification('Institution updated successfully!', 'success');
            }, 500);
        }

        function cancelEdit() {
            // Reset form values to original state (in a real app, you'd restore from saved data)
            setViewMode();
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 transition-all duration-300 transform translate-x-full`;
            const colorMap = {
                success: '#10B981',
                error: '#EF4444',
                info: '#3B82F6',
                'brand-success': '#d82128'
            };
            notification.style.backgroundColor = colorMap[type] || colorMap.success;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Slide in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);

            // Slide out and remove
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Enhanced Add Institution Flow
        let currentStep = 1;
        let fetchedData = {};

        function openAddInstitutionModal() {
            resetAddInstitutionFlow();
            document.getElementById('add-institution-modal').classList.remove('hidden');
        }

        function closeAddInstitutionModal() {
            document.getElementById('add-institution-modal').classList.add('hidden');
            resetAddInstitutionFlow();
        }

        function resetAddInstitutionFlow() {
            currentStep = 1;
            fetchedData = {};

            // Reset step indicators
            updateStepIndicators(1);

            // Show step 1, hide others
            document.getElementById('step-1').classList.remove('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.add('hidden');

            // Clear form
            document.getElementById('institution-name').value = '';
            document.getElementById('institution-url').value = '';
        }

        function updateStepIndicators(activeStep) {
            // Reset all indicators
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step-${i}-indicator`);
                const isActive = i === activeStep;
                const isCompleted = i < activeStep;

                if (isCompleted) {
                    indicator.style.backgroundColor = '#10B981'; // Green
                    indicator.classList.remove('bg-gray-200');
                    indicator.innerHTML = '<i data-lucide="check" class="w-4 h-4 text-white"></i>';
                } else if (isActive) {
                    indicator.style.backgroundColor = '#d82128'; // Red
                    indicator.classList.remove('bg-gray-200');
                    indicator.textContent = i;
                } else {
                    indicator.style.backgroundColor = '';
                    indicator.classList.add('bg-gray-200');
                    indicator.textContent = i;
                }
            }

            // Update progress bars
            document.getElementById('progress-1-2').style.backgroundColor = activeStep > 1 ? '#d82128' : '#e5e7eb';
            document.getElementById('progress-2-3').style.backgroundColor = activeStep > 2 ? '#d82128' : '#e5e7eb';

            // Re-initialize Lucide icons
            lucide.createIcons();
        }

        function fetchInstitutionInfo() {
            const name = document.getElementById('institution-name').value;
            const url = document.getElementById('institution-url').value;

            if (!name || !url) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Validate URL format
            try {
                new URL(url);
            } catch {
                showNotification('Please enter a valid URL', 'error');
                return;
            }

            // Move to step 2
            currentStep = 2;
            updateStepIndicators(2);
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');

            // Update status
            document.getElementById('fetch-status').innerHTML = `Fetching information from <span class="font-medium">${url}</span>...`;

            // Simulate AI fetching process
            simulateAIFetch(name, url);
        }

        function simulateAIFetch(name, url) {
            const steps = [
                { text: 'Analyzing website structure...', delay: 1000 },
                { text: 'Extracting institution information...', delay: 1500 },
                { text: 'Processing academic scholarships...', delay: 1200 },
                { text: 'Gathering admission requirements...', delay: 1000 },
                { text: 'Finalizing data collection...', delay: 800 }
            ];

            let currentStepIndex = 0;

            function updateProgress() {
                if (currentStepIndex < steps.length) {
                    document.getElementById('fetch-status').innerHTML = steps[currentStepIndex].text;

                    // Update checklist
                    const items = document.querySelectorAll('#step-2 .bg-gray-100 li');
                    if (items[currentStepIndex + 2]) {
                        const icon = items[currentStepIndex + 2].querySelector('i');
                        icon.setAttribute('data-lucide', 'check');
                        icon.classList.remove('text-blue-500', 'animate-spin', 'text-gray-400');
                        icon.classList.add('text-green-500');
                        lucide.createIcons();
                    }

                    currentStepIndex++;
                    setTimeout(updateProgress, steps[currentStepIndex - 1].delay);
                } else {
                    // Simulation complete, move to step 3
                    fetchedData = generateMockData(name, url);
                    goToStep3();
                }
            }

            updateProgress();
        }

        function generateMockData(name, url) {
            return {
                name: name,
                url: url,
                logo: 'https://via.placeholder.com/150',
                location: {
                    address: '',
                    city: '',
                    country: '',
                    coordinates: {
                        lat: null,
                        lng: null
                    },
                    mapEmbedUrl: ''
                },
                address: '',
                studentPopulation: '',
                establishedYear: '',
                type: 'University',
                partnerType: 'Strategic',
                contactName: '',
                contactEmail: '',
                contactPhone: '',
                overview: '',
                mission: '',
                admissions: {
                    graduation: {
                        englishLanguage: 'TOEFL iBT: 80\nIELTS: 6.5\nDuolingo: 105',
                        academicRequirements: "Bachelor's degree or equivalent\nMinimum GPA: 3.0"
                    },
                    nonMaster: {
                        englishLanguage: 'TOEFL iBT: 80\nIELTS: 6.5\nDuolingo: 105',
                        academicRequirements: 'High school diploma or equivalent\nMinimum GPA: 2.5'
                    },
                    requiredDocuments: 'Application form\nOfficial transcripts\nEnglish proficiency test scores\nPassport copy',
                    internationalStudentRequirements: 'Visa application\nFinancial proof\nHealth insurance'
                },
                campusLife: {
                    studentActivities: 'Student clubs and organizations\nSports teams\nCultural events\nLeadership programs',
                    campusFacilities: 'Library\nSports complex\nStudent center\nDining halls\nComputer labs'
                },
                programs: [
                    {
                        name: "Merit Scholarships",
                        level: "Undergraduate",
                        tuition: "$28,000 - $32,000 / year",
                        deadline: "Rolling Admissions",
                        requirements: ["IELTS: 6.0", "GPA: 2.5", "Fall 2025", "Spring 2026"]
                    },
                    {
                        name: "Athletic Scholarships",
                        level: "Graduate",
                        tuition: "$35,000 - $40,000 / year",
                        deadline: "March 15, 2025",
                        requirements: ["IELTS: 6.5", "GPA: 3.0", "GRE: 300+", "Fall 2025"]
                    },
                    {
                        name: "Arts Scholarships",
                        level: "Undergraduate",
                        tuition: "$25,000 - $30,000 / year",
                        deadline: "April 30, 2025",
                        requirements: ["IELTS: 6.0", "GPA: 2.8", "International Students Only", "Spring 2026"]
                    }
                ],
                scholarships: [],
                campusGallery: [],
                costAndTuition: {
                    tuitionFee: {
                        domestic: '',
                        international: ''
                    },
                    applicationFee: '',
                    scholarships: [],
                    financialAid: {
                        available: false,
                        description: ''
                    },
                    paymentPlans: []
                },
                quickStats: {
                    studentToFacultyRatio: '',
                    acceptanceRate: '',
                    averageClassSize: '',
                    graduationRate: '',
                    internationalStudents: ''
                }
            };
        }

        function goToStep3() {
            currentStep = 3;
            updateStepIndicators(3);
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');

            // Populate review content
            populateReviewContent();
        }

        function populateReviewContent() {
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = `
                <!-- Basic Information -->
                <div class="mb-6">
                    <div class="flex items-center mb-4">
                        <img src="${fetchedData.logo || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(fetchedData.name) + '&background=0D8ABC&color=fff'}" alt="${fetchedData.name}" class="h-16 w-16 rounded-lg">
                        <div class="ml-4">
                            <div class="flex items-center space-x-3">
                                <input type="text" class="text-xl font-semibold text-gray-900 border-gray-300 rounded" value="${fetchedData.name}">
                                <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span>
                                <i data-lucide="zap" class="w-4 h-4 text-yellow-500" title="AI-generated content"></i>
                            </div>
                            <input type="text" class="text-sm text-gray-500 border-gray-300 rounded mt-1" value="${fetchedData.location.city}, ${fetchedData.location.country} â€¢ Established ${fetchedData.establishedYear}">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-500">Location</p>
                            <div class="edit-mode">
                                <input type="text" class="w-full text-sm font-medium border-gray-300 rounded mb-2" value="${fetchedData.location.address}">
                                <input type="text" class="w-full text-xs border-gray-300 rounded" value="${fetchedData.location.city}, ${fetchedData.location.country}">
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-500">Student Population</p>
                            <div class="edit-mode">
                                <input type="text" class="w-full text-sm font-medium border-gray-300 rounded mb-2" value="${fetchedData.studentPopulation}">
                                <input type="text" class="w-full text-xs border-gray-300 rounded" value="Undergraduate & Graduate">
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-500">Website</p>
                            <div class="edit-mode">
                                <input type="url" class="w-full text-sm font-medium border-gray-300 rounded mb-2" value="${fetchedData.url}">
                                <input type="text" class="w-full text-xs border-gray-300 rounded" value="Official site">
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-500">Point of Contact</p>
                            <div class="edit-mode">
                                <input type="text" class="w-full text-sm font-medium border-gray-300 rounded mb-2" value="${fetchedData.contactName}">
                                <div class="flex space-x-2">
                                    <input type="email" class="flex-1 text-xs border-gray-300 rounded" value="${fetchedData.contactEmail}">
                                    <input type="tel" class="flex-1 text-xs border-gray-300 rounded" value="${fetchedData.contactPhone}">
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-500">Partner Type</p>
                            <div class="edit-mode">
                                <select class="w-full text-sm font-medium border-gray-300 rounded mb-2">
                                    <option value="moa-strategic" ${fetchedData.partnerType === 'Strategic' ? 'selected' : ''}>MOA â€¢ Strategic</option>
                                    <option value="moa">MOA</option>
                                    <option value="referral">Referral</option>
                                    <option value="strategic">Strategic</option>
                                </select>
                                <input type="text" class="w-full text-xs border-gray-300 rounded" value="Direct Partnership">
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-500">Established Year</p>
                            <div class="edit-mode">
                                <input type="number" class="w-full text-sm font-medium border-gray-300 rounded mb-2" value="${fetchedData.establishedYear}">
                                <input type="text" class="w-full text-xs border-gray-300 rounded" value="Historic Institution">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs Navigation -->
                <div class="mb-4 border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                        <button class="tab-link-review border-b-2 border-red-500 py-3 text-sm font-medium text-red-600" data-tab="overview">Overview</button>
                        <button class="tab-link-review border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300" data-tab="programs">Scholarships</button>
                        <button class="tab-link-review border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300" data-tab="admissions">Admission Requirements</button>
                        <button class="tab-link-review border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300" data-tab="campus">Campus Life</button>
                        <button class="tab-link-review border-b-2 border-transparent py-3 text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300" data-tab="costs">Cost and Tuition</button>
                    </nav>
                </div>

                <!-- Tab Panels -->
                <div class="flex-1 overflow-y-auto">
                    <!-- Overview Tab -->
                    <section id="tab-review-overview" class="tab-panel-review">
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                                    About
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="3">${fetchedData.overview}</textarea>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-2 flex items-center">
                                    Mission Statement
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="2">${fetchedData.mission}</textarea>
                            </div>
                        </div>
                    </section>

                    <!-- Scholarships Tab -->
                    <section id="tab-review-programs" class="tab-panel-review hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-semibold text-gray-900 flex items-center">
                                Scholarships
                                <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                <span class="ml-2 text-sm font-normal text-gray-500">(${fetchedData.programs.length} programs detected)</span>
                            </h4>
                            <div class="flex items-center space-x-2">
                                <button class="text-sm border px-3 py-1 rounded-lg hover:bg-gray-50 flex items-center">
                                    <i data-lucide="link" class="w-4 h-4 mr-1"></i>
                                    Link Scholarships
                                </button>
                                <button class="text-sm text-white px-3 py-1 rounded-lg flex items-center" style="background-color:#d82128;">
                                    <i data-lucide="plus" class="w-4 h-4 mr-1"></i>
                                    Add Scholarship
                                </button>
                            </div>
                        </div>

                        <div class="space-y-4">
                            ${fetchedData.programs.map(program => `
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <input type="text" class="w-full text-sm font-medium text-gray-900 border-gray-300 rounded mb-2" value="${program.name}">
                                            <div class="grid grid-cols-2 gap-2 mb-2">
                                                <input type="text" class="text-sm text-gray-500 border-gray-300 rounded" value="${program.level} â€¢ ${program.field}">
                                                <input type="text" class="text-sm text-gray-500 border-gray-300 rounded" value="${program.tuition}">
                                            </div>
                                        </div>
                                        <div class="flex space-x-2 ml-4">
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i data-lucide="edit" class="w-4 h-4"></i>
                                            </button>
                                            <button class="text-gray-400 hover:text-gray-600">
                                                <i data-lucide="archive" class="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3 flex flex-wrap gap-2">
                                        ${program.requirements.map(req => `
                                            <input type="text" class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800 border-0" value="${req}">
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </section>

                    <!-- Admissions Tab -->
                    <section id="tab-review-admissions" class="tab-panel-review hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-semibold text-gray-900 flex items-center">
                                Admission Requirements
                                <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                            </h4>
                        </div>

                        <div class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Master</h5>
                                    <label class="block text-xs text-gray-500 mb-1">English Language</label>
                                    <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded mb-3" rows="3">${fetchedData.admissionsBachelor?.englishLanguage || ''}</textarea>
                                    <label class="block text-xs text-gray-500 mb-1">Academic Requirements</label>
                                    <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="3">${fetchedData.admissionsBachelor?.academicRequirements || ''}</textarea>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h5 class="text-sm font-medium text-gray-900 mb-2">Bachelor</h5>
                                    <label class="block text-xs text-gray-500 mb-1">English Language</label>
                                    <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded mb-3" rows="3">${fetchedData.admissions.nonMaster?.englishLanguage || ''}</textarea>
                                    <label class="block text-xs text-gray-500 mb-1">Academic Requirements</label>
                                    <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="3">${fetchedData.admissions.nonMaster?.academicRequirements || ''}</textarea>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                                    Required Documents
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="4">${fetchedData.admissions.requiredDocuments}</textarea>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                                    International Student Requirements
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="4">${fetchedData.admissions.internationalStudentRequirements}</textarea>
                            </div>
                        </div>
                    </section>

                    <!-- Campus Life Tab -->
                    <section id="tab-review-campus" class="tab-panel-review hidden">
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                                    Student Activities
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="4">${fetchedData.campusLife.studentActivities}</textarea>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
                                    Campus Facilities
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <textarea class="w-full text-sm text-gray-700 border-gray-300 rounded" rows="4">${fetchedData.campusLife.campusFacilities}</textarea>
                            </div>
                        </div>
                    </section>

                    <!-- Cost and Tuition Tab -->
                    <section id="tab-review-costs" class="tab-panel-review hidden">
                        <div class="space-y-6">
                            <!-- Tuition & Application (includes Application Fee + Tuition & Fees) -->
                            <div style="background: rgb(249, 250, 251); padding: 16px; border-radius: 8px;">
                                <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                                    Tuition & Application
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>                               
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tuition & Fees</label>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <input type="number" placeholder="Min" class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="${fetchedData.costAndTuition?.tuitionFee?.min || ''}">
                                        <span style="color: rgb(153, 153, 153); font-size: 16px; font-weight: 500;">-</span>
                                        <input type="number" placeholder="Max" class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="${fetchedData.costAndTuition?.tuitionFee?.max || ''}">
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Application Fee (Part of Ellacy Program)</label>
                                    <input type="number" placeholder="Enter application fee" class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="${fetchedData.costAndTuition?.applicationFee || ''}">
                                </div>
                            </div>

                            <!-- Living Costs -->
                            <div style="background: rgb(249, 250, 251); padding: 16px; border-radius: 8px;">
                                <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                                    Living Costs
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Living Expenses (Housing and Food) - Per Year</label>
                                        <input type="number" placeholder="Enter housing cost" class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="${fetchedData.costAndTuition?.livingExpenses || ''}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Books & Supplies - Per Year</label>
                                        <input type="number" placeholder="Enter books cost" class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="${fetchedData.costAndTuition?.booksSupplies || ''}">
                                    </div>
                                </div>
                            </div>

                            <!-- Other Expenses -->
                            <div style="background: rgb(249, 250, 251); padding: 16px; border-radius: 8px;">
                                <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                                    Other Expenses (USD)
                                    <i data-lucide="zap" class="w-4 h-4 ml-2 text-yellow-500"></i>
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Transportation - Per Year</label>
                                        <input type="number" placeholder="Enter transportation cost" class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="${fetchedData.costAndTuition?.transportation || ''}">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Miscellaneous Personal Expenses - Per Year</label>
                                        <input type="number" placeholder="Enter personal expenses" class="w-full px-3 py-2 text-sm border-gray-300 rounded" value="${fetchedData.costAndTuition?.miscellaneous || ''}">
                                    </div>
                                </div>
                            </div>

                            <!-- Note Section -->
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div class="flex items-start">
                                    <i data-lucide="alert-circle" class="w-5 h-5 text-yellow-600 mr-2 flex-shrink-0 mt-0.5"></i>
                                    <div>
                                        <p class="text-sm font-medium text-yellow-900">AI-Generated Data</p>
                                        <p class="text-xs text-yellow-700 mt-1">Please review and update the cost information as needed. These values are estimated and may not reflect current tuition rates.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            `;

            // Add tab switching functionality for review content
            document.querySelectorAll('.tab-link-review').forEach(link => {
                link.addEventListener('click', function () {
                    const tabName = this.getAttribute('data-tab');
                    switchReviewTab(tabName);
                });
            });

            lucide.createIcons();
        }

        function switchReviewTab(tabName) {
            // Hide all tab panels
            document.querySelectorAll('.tab-panel-review').forEach(panel => {
                panel.classList.add('hidden');
            });

            // Remove active state from all tab links
            document.querySelectorAll('.tab-link-review').forEach(link => {
                link.classList.remove('border-red-500', 'text-red-600');
                link.classList.add('border-transparent', 'text-gray-600');
            });

            // Show selected tab panel
            const selectedPanel = document.getElementById(`tab-review-${tabName}`);
            if (selectedPanel) {
                selectedPanel.classList.remove('hidden');
            }

            // Set active state for selected tab link
            const selectedLink = document.querySelector(`.tab-link-review[data-tab="${tabName}"]`);
            if (selectedLink) {
                selectedLink.classList.remove('border-transparent', 'text-gray-600');
                selectedLink.classList.add('border-red-500', 'text-red-600');
            }
        }

        function skipToManualEntry() {
            // Generate sample data for manual entry
            const name = document.getElementById('institution-name').value || 'University of Technology';
            const url = document.getElementById('institution-url').value || 'https://www.utech.edu';

            fetchedData = {
                name: name,
                url: url,
                logo: 'https://via.placeholder.com/150',
                location: {
                    address: '155 Miami St. Tiffin',
                    city: 'Ohio',
                    country: 'United States',
                    coordinates: {
                        lat: 40.7128,
                        lng: -74.0060
                    },
                    mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3022.215209105331!2d-73.9878446845937!3d40.74844047932881!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNDDCsDQ0JzU0LjQiTiA3M8KwNTknMTguNyJX!5e0!3m2!1sen!2sus!4v1620000000000!5m2!1sen!2sus'
                },
                address: '123 University Avenue, New York, NY 10001',
                studentPopulation: '25,000+',
                establishedYear: '1950',
                type: 'University',
                partnerType: 'Strategic',
                contactName: 'John Smith',
                contactEmail: 'admissions@utech.edu',
                contactPhone: '+1 (212) 555-0123',
                overview: 'A leading technological university known for its innovative scholarships and research initiatives. We prepare students for successful careers in the digital age through hands-on learning and industry partnerships.',
                mission: 'To empower students through technology, innovation, and academic excellence, fostering the next generation of leaders and problem solvers.',
                admissions: {
                    graduation: {
                        englishLanguage: 'TOEFL iBT: 80\nIELTS: 6.5\nDuolingo: 105',
                        academicRequirements: "Bachelor's degree or equivalent\nMinimum GPA: 3.0"
                    },
                    nonMaster: {
                        englishLanguage: 'TOEFL iBT: 80\nIELTS: 6.5\nDuolingo: 105',
                        academicRequirements: 'High school diploma or equivalent\nMinimum GPA: 2.5'
                    },
                    requiredDocuments: 'Application form\nOfficial transcripts\nEnglish proficiency test scores\nPassport copy',
                    internationalStudentRequirements: 'Visa application\nFinancial proof\nHealth insurance'
                },
                campusLife: {
                    studentActivities: 'Student clubs and organizations\nSports teams\nCultural events\nLeadership programs',
                    campusFacilities: 'Library\nSports complex\nStudent center\nDining halls\nComputer labs'
                },
                programs: [
                    {
                        name: "Merit Scholarships",
                        level: "Undergraduate",
                        field: "All Fields",
                        tuition: "$28,000 - $32,000 / year",
                        deadline: "Rolling Admissions",
                        requirements: ["IELTS: 6.0", "GPA: 2.5", "Fall 2025", "Spring 2026"]
                    },
                    {
                        name: "Graduate Assistantships",
                        level: "Graduate",
                        field: "STEM Fields",
                        tuition: "$35,000 - $40,000 / year",
                        deadline: "March 15, 2025",
                        requirements: ["IELTS: 6.5", "GPA: 3.0", "GRE: 300+", "Fall 2025"]
                    },
                    {
                        name: "International Student Scholarships",
                        level: "Undergraduate",
                        field: "Business & Technology",
                        tuition: "$25,000 - $30,000 / year",
                        deadline: "April 30, 2025",
                        requirements: ["IELTS: 6.0", "GPA: 2.8", "International Students Only", "Spring 2026"]
                    }
                ],
                campusGallery: [],
                costAndTuition: {
                    tuitionFee: {
                        domestic: '',
                        international: ''
                    },
                    applicationFee: '',
                    scholarships: [],
                    financialAid: {
                        available: false,
                        description: ''
                    },
                    paymentPlans: []
                },
                quickStats: {
                    studentToFacultyRatio: '',
                    acceptanceRate: '',
                    averageClassSize: '',
                    graduationRate: '',
                    internationalStudents: ''
                }
            };

            goToStep3();
        }

        function goBackToStep2() {
            currentStep = 2;
            updateStepIndicators(2);
            document.getElementById('step-3').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
        }

        function saveNewInstitution() {
            // Here you would collect all the form data and send to server
            // For now, we'll just show a success message and switch back to view mode

            // Simulate saving
            showNotification('Institution saved successfully!', 'success');
            closeAddInstitutionModal();

            // In a real app, you would refresh the institutions table here
        }

        // Handle logout
        function handleLogout() {
            console.log('Logging out...');
            window.location.href = '../../login.html';
        }

        // AI Assistant functionality
        const aiToggle = document.getElementById('ai-toggle');
        const aiChatPanel = document.getElementById('ai-chat-panel');
        const aiClose = document.getElementById('ai-close');
        const chatInput = document.getElementById('chat-input');
        const sendMessage = document.getElementById('send-message');
        const chatMessages = document.getElementById('chat-messages');

        aiToggle.addEventListener('click', () => {
            aiChatPanel.classList.toggle('hidden');
        });

        aiClose.addEventListener('click', () => {
            aiChatPanel.classList.add('hidden');
        });

        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'mb-4';

            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="flex items-start justify-end">
                        <div class="rounded-lg p-3 max-w-xs text-white" style="background-color: #d82128;">
                            <p class="text-sm">${message}</p>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-start">
                        <div class="w-6 h-6 rounded-full bg-red-100 flex items-center justify-center mr-2 mt-1">
                            <i data-lucide="bot" class="w-3 h-3" style="color: #d82128;"></i>
                        </div>
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-sm text-gray-800">${message}</p>
                        </div>
                    </div>
                `;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            lucide.createIcons();
        }

        function handleSendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                addMessage(message, true);
                chatInput.value = '';

                // Simulate AI response
                setTimeout(() => {
                    const responses = [
                        "University of Toronto shows 85% student placement success with 15 active scholarships. Consider expanding partnership for high-demand fields like Computer Science.",
                        "Analysis shows Australian institutions have 20% higher enrollment rates. I recommend prioritizing partnerships with universities in Melbourne and Sydney.",
                        "Your MOA partners generate 40% more qualified applications than referral partners. Consider upgrading strategic partnerships to MOA status.",
                        "Institution performance data indicates that universities with 10+ scholarships have better student retention rates. Focus on comprehensive scholarship offerings."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse);
                }, 1000);
            }
        }

        sendMessage.addEventListener('click', handleSendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSendMessage();
            }
        });

        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tab panels
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.add('hidden');
            });

            // Remove active state from all tab links
            document.querySelectorAll('.tab-link').forEach(link => {
                link.classList.remove('border-red-500', 'text-red-600');
                link.classList.add('border-transparent', 'text-gray-600');
            });

            // Show selected tab panel
            const selectedPanel = document.getElementById(`tab-${tabName}`);
            if (selectedPanel) {
                selectedPanel.classList.remove('hidden');
            }

            // Set active state for selected tab link
            const selectedLink = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedLink) {
                selectedLink.classList.remove('border-transparent', 'text-gray-600');
                selectedLink.classList.add('border-red-500', 'text-red-600');
            }
        }

        // Add event listeners for tab links
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.tab-link').forEach(link => {
                link.addEventListener('click', function () {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        });

        // Initialize Select2 for dropdowns
        $(document).ready(function () {
            $('select').select2({
                minimumResultsForSearch: 6
            });
        });
    </script>
    <script>
        // Top-level submenu tabs switching
        function switchTopTab(tabName) {
            // Hide all panels
            document.querySelectorAll('.top-tab-panel').forEach(panel => panel.classList.add('hidden'));
            // Deactivate all links
            document.querySelectorAll('.top-tab-link').forEach(link => {
                link.classList.remove('border-red-500', 'text-red-600');
                link.classList.add('border-transparent', 'text-gray-600');
            });
            // Show selected panel
            const panel = document.getElementById(`panel-${tabName}`);
            if (panel) panel.classList.remove('hidden');
            // Activate selected link
            const link = document.querySelector(`.top-tab-link[data-top-tab="${tabName}"]`);
            if (link) {
                link.classList.remove('border-transparent', 'text-gray-600');
                link.classList.add('border-red-500', 'text-red-600');
            }
            if (window.lucide) lucide.createIcons();
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.top-tab-link').forEach(link => {
                link.addEventListener('click', function () {
                    const tabName = this.getAttribute('data-top-tab');
                    switchTopTab(tabName);
                });
            });
            // Default to Institutions tab
            switchTopTab('institutions');
        });
    </script>
    <script>
        // Partner Universities Carousel Config - LocalStorage CRUD
        const LS_KEY = 'partnerUniversities';
        const partnersTableBody = document.getElementById('partnersTableBody');
        const partnersEmptyState = document.getElementById('partnersEmptyState');
        const partnersPreview = document.getElementById('partnersPreview');
        const addPartnerBtn = document.getElementById('addPartnerBtn');
        const clearPartnersBtn = document.getElementById('clearPartnersBtn');
        const partnerSelectModal = document.getElementById('partnerSelectModal');
        const institutionSelectList = document.getElementById('institutionSelectList');
        const institutionSelectSearch = document.getElementById('institutionSelectSearch');
        const partnerSelectCancel = document.getElementById('partnerSelectCancel');
        const partnerSelectCloseX = document.getElementById('partnerSelectCloseX');

        function loadPartners() {
            try {
                const raw = localStorage.getItem(LS_KEY);
                return raw ? JSON.parse(raw) : [];
            } catch { return []; }
        }
        function savePartners(list) { localStorage.setItem(LS_KEY, JSON.stringify(list)); }

        function renderTable() {
            const list = loadPartners();
            partnersTableBody.innerHTML = '';
            if (!list.length) {
                partnersEmptyState.classList.remove('hidden');
            } else {
                partnersEmptyState.classList.add('hidden');
            }
            list.forEach((p, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-4 py-2 align-top"><div class="truncate max-w-[260px] text-xs text-gray-700">${p.logo || ''}</div></td>
                    <td class="px-4 py-2 align-top"><div class="text-sm font-medium text-gray-900">${p.name || ''}</div></td>
                    <td class="px-4 py-2 align-top"><div class="text-xs text-gray-600">${p.location || ''}</div></td>
                    <td class="px-4 py-2 align-top"><div class="text-xs text-gray-700 max-w-xs line-clamp-3">${p.description || ''}</div></td>
                    <td class="px-4 py-2 align-top"><div class="flex flex-wrap gap-1">${(p.hashtags || []).map(h => `<span class='px-2 py-0.5 rounded-full text-[10px] bg-gray-100 text-gray-700'>${h}</span>`).join('')}</div></td>
                    <td class="px-4 py-2 align-top text-right">
                        <button class="text-gray-600 hover:text-red-600 mr-2" data-action="edit" data-idx="${idx}"><i data-lucide="edit" class="w-4 h-4"></i></button>
                        <button class="text-red-600 hover:text-red-800" data-action="delete" data-idx="${idx}"><i data-lucide="trash" class="w-4 h-4"></i></button>
                    </td>`;
                partnersTableBody.appendChild(tr);
            });
            if (window.lucide) lucide.createIcons();
        }

        function renderPreview() {
            const list = loadPartners();
            partnersPreview.innerHTML = '';
            // Build two sets for seamless loop
            const twoSets = [...list, ...list];
            twoSets.forEach(p => {
                const card = document.createElement('div');
                card.className = 'flex-shrink-0 w-72 bg-white rounded-xl border border-gray-200 p-4 shadow-sm hover:shadow-md transition';
                card.innerHTML = `
                    <div class="flex items-center gap-3 mb-2">
                        <img src="${p.logo || ''}" alt="${p.name || ''}" class="w-10 h-10 object-contain">
                        <div>
                            <p class="text-sm font-semibold text-gray-900">${p.name || ''}</p>
                            <p class="text-xs text-gray-500">${p.location || ''}</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-700 mb-2">${p.description || ''}</p>
                    <div class="flex flex-wrap gap-1">${(p.hashtags || []).map(h => `<span class='px-2 py-0.5 rounded-full text-[10px] bg-gray-100 text-gray-700'>${h}</span>`).join('')}</div>
                `;
                partnersPreview.appendChild(card);
            });
        }

        // Build institution list from Institutions table
        function getInstitutionsFromTable() {
            const rows = document.querySelectorAll('#panel-institutions tbody tr');
            const list = [];
            rows.forEach(tr => {
                const img = tr.querySelector('img');
                const nameEl = tr.querySelector('td .text-sm.font-medium');
                const countryEl = tr.querySelector('td:nth-child(2)');
                const name = nameEl ? nameEl.textContent.trim() : '';
                const logo = img ? img.getAttribute('src') : '';
                const location = countryEl ? countryEl.textContent.trim() : '';
                if (name) list.push({ name, logo, location });
            });
            return list;
        }

        function openPartnerSelectModal() {
            const institutions = getInstitutionsFromTable();
            institutionSelectList.innerHTML = '';
            institutions.forEach((inst, idx) => {
                const li = document.createElement('li');
                li.className = 'p-3 hover:bg-gray-50 flex items-center justify-between';
                li.innerHTML = `
                    <div class="flex items-center gap-3">
                        <img src="${inst.logo}" alt="${inst.name}" class="w-8 h-8 rounded-full object-contain">
                        <div>
                            <p class="text-sm font-medium text-gray-900">${inst.name}</p>
                            <p class="text-xs text-gray-500">${inst.location}</p>
                        </div>
                    </div>
                    <button class="px-3 py-1 text-sm text-white rounded" data-action="select" data-idx="${idx}" style="background-color:#d82128;">Select</button>
                `;
                institutionSelectList.appendChild(li);
            });
            partnerSelectModal.classList.remove('hidden');
            if (window.lucide) lucide.createIcons();
        }

        function closePartnerSelectModal() { partnerSelectModal.classList.add('hidden'); }

        // Filter search within selection list
        if (institutionSelectSearch) {
            institutionSelectSearch.addEventListener('input', () => {
                const term = institutionSelectSearch.value.toLowerCase();
                Array.from(institutionSelectList.children).forEach(li => {
                    const text = li.textContent.toLowerCase();
                    li.style.display = text.includes(term) ? '' : 'none';
                });
            });
        }

        // Handle selection click
        if (institutionSelectList) {
            institutionSelectList.addEventListener('click', (e) => {
                const btn = e.target.closest('button[data-action="select"]');
                if (!btn) return;
                const idx = parseInt(btn.dataset.idx, 10);
                const institutions = getInstitutionsFromTable();
                const inst = institutions[idx];
                if (inst) {
                    upsertPartner({ logo: inst.logo, name: inst.name, location: inst.location, description: '', hashtags: [] });
                    closePartnerSelectModal();
                }
            });
        }

        // Close selection modal buttons
        if (partnerSelectCancel) partnerSelectCancel.addEventListener('click', closePartnerSelectModal);
        if (partnerSelectCloseX) partnerSelectCloseX.addEventListener('click', closePartnerSelectModal);

        function upsertPartner(initial, index = null) {
            // Populate modal fields
            document.getElementById('partnerLogo').value = initial?.logo || '';
            document.getElementById('partnerName').value = initial?.name || '';
            document.getElementById('partnerLocation').value = initial?.location || '';
            document.getElementById('partnerDesc').value = initial?.description || '';
            document.getElementById('partnerTags').value = (initial?.hashtags || []).join(', ');
            document.getElementById('partnerIndex').value = index == null ? '' : String(index);
            document.getElementById('partnerModalTitle').textContent = index == null ? 'Add Partner' : 'Edit Partner';
            document.getElementById('partnerModal').classList.remove('hidden');
        }

        function closePartnerModal() { document.getElementById('partnerModal').classList.add('hidden'); }

        document.addEventListener('DOMContentLoaded', () => {
            // Seed once if empty with example 3 to visualize
            const existing = loadPartners();
            if (!existing.length) {
                savePartners([
                    { logo: '../../tiffin-university-logo.png', name: 'Tiffin University', location: 'Tiffin, USA', description: 'Career-focused programs and mentorship.', hashtags: ['2+2', 'Exchange'] },
                    { logo: 'https://imgs.search.brave.com/0hWMuoaUWNAyGWv5n6H4tzAYFH3X_pleytwTvgVAKAg/rs:fit:32:32:1:0/g:ce/aHR0cDovL2Zhdmlj/b25zLnNlYXJjaC5i/cmF2ZS5jb20vaWNv/bnMvNGY2ZWY4MWJh/MzM3MmNlYWM5ZGEw/MDMyZmRmZjBhZWYy/NDNlYWYyNjc1NmUz/YmNiNThjZDk2MTg0/NjcxOTE1Yy93d3cu/YW5nZWxvLmVkdS8', name: 'Angelo State University', location: 'San Angelo, USA', description: 'Personalized education and student support.', hashtags: ['2+2'] },
                    { logo: 'https://imgs.search.brave.com/vWqXUEDq-6yOdvybXfzZ3HIe2bsNag2-dXlJfNn-9u8/rs:fit:32:32:1:0/g:ce/aHR0cDovL2Zhdmlj/b25zLnNlYXJjaC5i/cmF2ZS5jb20vaWNv/bnMvNjk0NjkwYTlj/YzdhNzJmYTYyZTc0/NjI5ZDY4ZWRiZTE5/NWFhZDhmMzQ5NTIz/NTBhMTFkYmY5OTA3/OWZlMWZiYy93d3cu/YnV0bGVyLmVkdS8', name: 'Butler University', location: 'Indianapolis, USA', description: 'Strong liberal arts and business programs.', hashtags: ['2+2'] }
                ]);
            }
            renderTable();
            renderPreview();

            if (addPartnerBtn) addPartnerBtn.addEventListener('click', () => openPartnerSelectModal());
            if (clearPartnersBtn) clearPartnersBtn.addEventListener('click', () => {
                if (confirm('Clear all partner universities?')) { savePartners([]); renderTable(); renderPreview(); }
            });


            partnersTableBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button'); if (!btn) return;
                const idx = parseInt(btn.dataset.idx, 10);
                const list = loadPartners();
                if (btn.dataset.action === 'edit') {
                    upsertPartner(list[idx], idx);
                } else if (btn.dataset.action === 'delete') {
                    if (confirm('Delete this partner?')) { list.splice(idx, 1); savePartners(list); renderTable(); renderPreview(); }
                }
            });
        });

        // Modal actions
        document.getElementById('partnerCancel').addEventListener('click', closePartnerModal);
        document.getElementById('partnerCloseX').addEventListener('click', closePartnerModal);
        document.getElementById('partnerSave').addEventListener('click', () => {
            const logo = document.getElementById('partnerLogo').value.trim();
            const name = document.getElementById('partnerName').value.trim();
            const location = document.getElementById('partnerLocation').value.trim();
            const description = document.getElementById('partnerDesc').value.trim();
            const tags = document.getElementById('partnerTags').value.split(',').map(s => s.trim()).filter(Boolean);
            const idxStr = document.getElementById('partnerIndex').value;
            if (!name) { alert('Name is required'); return; }
            const list = loadPartners();
            const payload = { logo, name, location, description, hashtags: tags };
            if (idxStr === '') { list.push(payload); } else { list[parseInt(idxStr, 10)] = payload; }
            savePartners(list); renderTable(); renderPreview(); closePartnerModal();
            showNotification('Partner saved', 'success');
        });
    </script>

    <script>
        // Institution Tiers - LocalStorage CRUD
        const TIERS_LS_KEY = 'institutionTiers';
        const tiersTableBody = document.getElementById('tiersTableBody');
        const tiersEmptyState = document.getElementById('tiersEmptyState');
        const addTierBtn = document.getElementById('addTierBtn');

        function loadTiers() {
            try {
                const raw = localStorage.getItem(TIERS_LS_KEY);
                return raw ? JSON.parse(raw) : [];
            } catch { return []; }
        }
        function saveTiers(list) { localStorage.setItem(TIERS_LS_KEY, JSON.stringify(list)); }

        function renderTiersTable() {
            const tiers = loadTiers();
            tiersTableBody.innerHTML = '';
            if (!tiers.length) {
                tiersEmptyState.classList.remove('hidden');
                return;
            }
            tiersEmptyState.classList.add('hidden');
            tiers.forEach((tier, idx) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${tier.name || ''}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-700">${tier.description || ''}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="inline-flex items-center gap-2">
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" ${tier.status === 'active' ? 'checked' : ''} class="sr-only peer tier-status-toggle" data-idx="${idx}">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                            </label>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <div class="flex space-x-2">
                            <button class="text-gray-600 hover:text-red-600" data-action="edit" data-idx="${idx}">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800" data-action="delete" data-idx="${idx}">
                                <i data-lucide="trash" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </td>
                `;
                tiersTableBody.appendChild(row);
            });
            if (window.lucide) lucide.createIcons();
        }

        function upsertTier(initial, index = null) {
            document.getElementById('tierName').value = initial?.name || '';
            document.getElementById('tierDesc').value = initial?.description || '';
            document.getElementById('tierIndex').value = index == null ? '' : String(index);
            document.getElementById('tierModalTitle').textContent = index == null ? 'Create New Institution Tier' : 'Edit Institution Tier';
            document.getElementById('tierModal').classList.remove('hidden');
            if (window.lucide) lucide.createIcons();
        }

        function closeTierModal() {
            document.getElementById('tierModal').classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Seed with sample data if empty
            const existing = loadTiers();
            if (!existing.length) {
                saveTiers([
                    { name: 'Guaranteed Scholarship Program', description: 'Scholarships that are guaranteed for eligible students', status: 'active' },
                    { name: 'Elite Admission Program', description: 'Premium scholarships for high-achieving students', status: 'active' },
                    { name: 'Ivy Global Student Program', description: 'Scholarships for students targeting top-tier institutions', status: 'active' },
                    { name: 'Joint Program Vietnam to US Transfer', description: 'Transfer program scholarships from Vietnam to US universities', status: 'active' },
                ]);
            }
            renderTiersTable();

            if (addTierBtn) addTierBtn.addEventListener('click', () => upsertTier());

            tiersTableBody.addEventListener('click', (e) => {
                const btn = e.target.closest('button'); if (!btn) return;
                const idx = parseInt(btn.dataset.idx, 10);
                const list = loadTiers();
                if (btn.dataset.action === 'edit') {
                    upsertTier(list[idx], idx);
                } else if (btn.dataset.action === 'delete') {
                    if (confirm('Delete this tier?')) {
                        list.splice(idx, 1);
                        saveTiers(list);
                        renderTiersTable();
                    }
                }
            });

            // Handle status toggle
            tiersTableBody.addEventListener('change', (e) => {
                if (e.target.classList.contains('tier-status-toggle')) {
                    const idx = parseInt(e.target.dataset.idx, 10);
                    const list = loadTiers();
                    list[idx].status = e.target.checked ? 'active' : 'inactive';
                    saveTiers(list);
                    showNotification(`Tier ${e.target.checked ? 'activated' : 'deactivated'}`, 'success');
                }
            });
        });

        // Modal actions
        document.getElementById('tierCancel').addEventListener('click', closeTierModal);
        document.getElementById('tierCloseX').addEventListener('click', closeTierModal);
        document.getElementById('tierSave').addEventListener('click', () => {
            const name = document.getElementById('tierName').value.trim();
            const description = document.getElementById('tierDesc').value.trim();
            const idxStr = document.getElementById('tierIndex').value;
            if (!name) { alert('Name is required'); return; }
            const list = loadTiers();
            const payload = { name, description, status: 'active' };
            if (idxStr === '') { list.push(payload); } else { list[parseInt(idxStr, 10)] = payload; }
            saveTiers(list);
            renderTiersTable();
            closeTierModal();
            showNotification('Tier saved', 'success');
        });

        // ===== INTAKES MANAGEMENT =====
        let hasUnsavedChanges = false;

        function markUnsavedChanges() {
            hasUnsavedChanges = true;
            const warningBanner = document.getElementById('unsavedChangesWarning');
            if (warningBanner) {
                warningBanner.classList.remove('hidden');
                if (window.lucide) lucide.createIcons();
            }
        }

        function clearUnsavedChanges() {
            hasUnsavedChanges = false;
            const warningBanner = document.getElementById('unsavedChangesWarning');
            if (warningBanner) {
                warningBanner.classList.add('hidden');
            }
        }

        function initializeIntakes() {
            // Initialize status toggle listeners using event delegation
            document.addEventListener('change', function (e) {
                if (e.target.classList.contains('intake-toggle')) {
                    const season = e.target.dataset.season;
                    const statusText = document.getElementById(`${season}StatusText`);
                    if (statusText) {
                        updateIntakeStatus(season, e.target.checked, statusText);
                        markUnsavedChanges();
                    }
                }
            });

            // Load saved intakes from localStorage
            loadIntakesFromStorage();
        }

        function updateIntakeStatus(season, isActive, statusTextElement) {
            if (isActive) {
                statusTextElement.className = 'px-2 py-1 rounded-full bg-green-100 text-green-800';
                statusTextElement.textContent = 'Active';
            } else {
                statusTextElement.className = 'px-2 py-1 rounded-full bg-gray-100 text-gray-800';
                statusTextElement.textContent = 'Inactive';
            }
        }

        // Helper to safely restore the Save button
        function restoreSaveButton(btn) {
            if (!btn) return;
            btn.disabled = false;
            btn.classList.remove('opacity-80', 'cursor-not-allowed');
            btn.innerHTML = btn.dataset?.originalText || '<i data-lucide="save" class="w-4 h-4 inline mr-2"></i>Save Changes';
            if (window.lucide) lucide.createIcons();
        }

        function saveIntakes() {
            const btn = document.getElementById('saveIntakesBtn');
            if (btn) {
                // Prevent double click while saving
                if (btn.disabled) return;
                btn.disabled = true;
                btn.dataset.originalText = btn.innerHTML || '<i data-lucide="save" class="w-4 h-4 inline mr-2"></i>Save Changes';
                btn.classList.add('opacity-80', 'cursor-not-allowed');
                btn.innerHTML = '<i data-lucide="save" class="w-4 h-4 inline mr-2"></i>Saving...';
                if (window.lucide) lucide.createIcons();
            }

            // Watchdog: ensure we always restore button even if anything fails
            const watchdog = setTimeout(() => restoreSaveButton(btn), 5000);

            // Optional: show a light info notice (commented to reduce noise)
            // showNotification('Saving intake settings...', 'info');

            // Simulate processing before saving & confirming
            setTimeout(() => {
                try {
                    const getVal = (id) => {
                        const el = document.getElementById(id);
                        return el && typeof el.value !== 'undefined' ? el.value : '';
                    };
                    const getChecked = (id) => {
                        const el = document.getElementById(id);
                        return el && typeof el.checked !== 'undefined' ? !!el.checked : false;
                    };

                    const intakesData = {
                        spring: { year: getVal('springYear'), status: getChecked('springStatus') },
                        summer: { year: getVal('summerYear'), status: getChecked('summerStatus') },
                        fall: { year: getVal('fallYear'), status: getChecked('fallStatus') },
                        winter: { year: getVal('winterYear'), status: getChecked('winterStatus') }
                    };

                    // Mock save and always show success
                    localStorage.setItem('intakesConfig', JSON.stringify(intakesData));
                    console.log('Intakes saved:', intakesData);
                } finally {
                    // Restore button state FIRST to avoid getting stuck on errors below
                    restoreSaveButton(btn);
                    clearTimeout(watchdog);

                    // Then clear warning and show success toast, but guard to avoid breaking UI
                    try { clearUnsavedChanges(); } catch (e) { /* no-op */ }
                    try {
                        if (typeof showNotification === 'function') {
                            showNotification('Intake settings saved successfully! Changes will be reflected in Student and Agency pages.', 'brand-success');
                        }
                    } catch (e) { /* no-op */ }
                }
            }, 1000);
        }

        function resetIntakes() {
            if (confirm('Reset all intake settings to default values? This will immediately save and affect Student and Agency pages.')) {
                const defaultIntakes = {
                    spring: { year: '2025', status: true },
                    summer: { year: '2025', status: true },
                    fall: { year: '2025', status: true },
                    winter: { year: '2026', status: false }
                };

                // Update UI
                document.getElementById('springYear').value = defaultIntakes.spring.year;
                document.getElementById('springStatus').checked = defaultIntakes.spring.status;
                updateIntakeStatus('spring', defaultIntakes.spring.status, document.getElementById('springStatusText'));

                document.getElementById('summerYear').value = defaultIntakes.summer.year;
                document.getElementById('summerStatus').checked = defaultIntakes.summer.status;
                updateIntakeStatus('summer', defaultIntakes.summer.status, document.getElementById('summerStatusText'));

                document.getElementById('fallYear').value = defaultIntakes.fall.year;
                document.getElementById('fallStatus').checked = defaultIntakes.fall.status;
                updateIntakeStatus('fall', defaultIntakes.fall.status, document.getElementById('fallStatusText'));

                document.getElementById('winterYear').value = defaultIntakes.winter.year;
                document.getElementById('winterStatus').checked = defaultIntakes.winter.status;
                updateIntakeStatus('winter', defaultIntakes.winter.status, document.getElementById('winterStatusText'));

                // Save to localStorage
                localStorage.setItem('intakesConfig', JSON.stringify(defaultIntakes));
                clearUnsavedChanges();
                showNotification('Intake settings reset to default', 'success');
            }
        }

        function loadIntakesFromStorage() {
            const saved = localStorage.getItem('intakesConfig');
            if (saved) {
                const intakesData = JSON.parse(saved);

                // Update UI with saved values
                Object.keys(intakesData).forEach(season => {
                    const yearInput = document.getElementById(`${season}Year`);
                    const statusCheckbox = document.getElementById(`${season}Status`);
                    const statusText = document.getElementById(`${season}StatusText`);

                    if (yearInput && intakesData[season].year) {
                        yearInput.value = intakesData[season].year;
                    }
                    if (statusCheckbox && statusText) {
                        statusCheckbox.checked = intakesData[season].status;
                        updateIntakeStatus(season, intakesData[season].status, statusText);
                    }
                });
            }
        }

        // Initialize intakes when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            initializeIntakes();
        });
    </script>
    <script>
        // Toggle Partner Brief visibility based on checkbox state
        document.addEventListener('DOMContentLoaded', () => {
            const partnerChk = document.getElementById('isPartnerUniversity');
            const briefContainer = document.getElementById('partnerBriefContainer');
            function syncPartnerBrief() {
                if (!partnerChk || !briefContainer) return;
                if (partnerChk.checked) {
                    briefContainer.classList.remove('hidden');
                } else {
                    briefContainer.classList.add('hidden');
                }
            }
            if (partnerChk) {
                partnerChk.addEventListener('change', syncPartnerBrief);
                // Initial sync
                syncPartnerBrief();
            }
        });
    </script>
</body>